<!DOCTYPE HTML>
<html lang="zh-CN">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="shortcut icon" type="image/png"
		href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAe1BMVEUDuu3///8AtuwAue1c0/QAt+1a0vSZ4/gOve4Ju+4AtOzf9v31/P4iw/DS8/yf5fnE7/tNzvMsxvHw+/7t+v7k+P2U4veO4PeA3Pbp+f7h9/3Y9f3I8Pxt1/Vi1PRQz/NDzPIzyPEWv+76/v/3/f+87fqn5/mI3/Z82vb+fQDoAAAA10lEQVQ4y63T2c7CIBCGYWamUwFZurfuy7/e/xVaeySlYmJ8T78nISQgPh0xU2pGZa1EfrazHJz5an2FT3brYKoul4UqAHx5Hhqoq6VTMAc4aER9acDjEviFPd2voP9gKykGVECHkzyBsRzvI+g1jWG5BFDIPXRKjqkcTKUwPISPbvsN9XpqA9DuehXsF4g64APALAY+AHkMVm+CzToNVld1NAmwE0zaJ0DBQughAcxZ66tLAGj6f/f2NdMgewXKGHSPgOTPfG/Dh0vqlAXlluefahaLT3UDvrAKrj7jLKkAAAAASUVORK5CYII=" />
	<!-- Bootstrap 5 CSS -->
	<link href="https://testingcf.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<!-- Bootstrap Icons -->
	<link href="https://testingcf.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
	<!-- è‡ªå®šä¹‰æ ·å¼ -->
	<link href="styles.css" rel="stylesheet">
	<title>å¿«ç‚¹SSLè¯ä¹¦ | å…è´¹HTTPSè¯ä¹¦åœ¨çº¿ç”³è¯·</title>
	<meta name="description" content="å…è´¹ç”³è¯·Let's Encryptã€ZeroSSLç­‰HTTPSè¯ä¹¦">
	<meta name="keywords" content="SSL,HTTPS,è¯ä¹¦,Let's Encrypt,ZeroSSL,å…è´¹è¯ä¹¦,åœ¨çº¿ç”³è¯·">
</head>

<body>
	<script>
		var Version = "1.0.1";
		console.log("LICENSE: GPL-3.0, https://github.com/muzihuaner/ACME-HTML-Web-Browser-Client");
	</script>


	<div class="main-load">
		<div class="spinner-border text-light" role="status">
			<span class="visually-hidden">Loading...</span>
		</div>
		<span class="ms-3">æ­£åœ¨åŠ è½½...</span>
	</div>

	<div class="main" style="display:none">
		<div class="mainBox acmeReadDirGotoCORSState" style="display:none"></div>

		<!-- ä¸»æ ‡é¢˜åŒºåŸŸ -->
		<div class="mainBox">
			<div class="text-center py-4">
				<div class="mb-4">
					<div class="feature-icon text-primary" style="font-size: 3rem;">
						<i class="bi bi-shield-lock-fill"></i>
						<span class="fallback-icon">ğŸ”’</span>
					</div>
				</div>
				<h1 class="display-4 fw-bold text-primary mb-3">
					<span class="langCN clientNameCN">å¿«ç‚¹SSLè¯ä¹¦</span>
					<span class="langEN clientNameEN">Quick SSL Certificate</span>
				</h1>
				<p class="lead text-muted mb-4">
					<span class="langCN">å…è´¹ç”³è¯·Let's Encryptã€ZeroSSLç­‰HTTPSè¯ä¹¦</span>
					<span class="langEN">Free SSL certificates from Let's Encrypt, ZeroSSL and more</span>
				</p>
				<div class="d-flex justify-content-center align-items-center gap-3 flex-wrap">
					<span class="versionBox badge bg-primary fs-6"></span>
					<div class="d-flex gap-2">
						<a href="https://github.com/muzihuaner/ACME-HTML-Web-Browser-Client" target="_blank"
							class="btn btn-outline-primary btn-sm">
							<i class="bi bi-github"></i> GitHub
						</a>
					</div>
				</div>
			</div>

			<!-- åŠŸèƒ½ç‰¹ç‚¹ -->
			<div class="row g-4 mt-3">
				<div class="col-md-4">
					<div class="text-center">
						<div class="feature-icon text-warning" style="font-size: 2rem;">
							<i class="bi bi-lightning-charge-fill"></i>
							<span class="fallback-icon">âš¡</span>
						</div>
						<h5 class="mt-3 langCN">ç®€å•æ˜“ç”¨</h5>
						<h5 class="mt-3 langEN">Easy to Use</h5>
						<p class="text-muted small langCN">æ— éœ€æ³¨å†Œè´¦å·ï¼Œç‚¹å‡»å‡ ä¸‹å³å¯å®Œæˆ</p>
						<p class="text-muted small langEN">No registration required, just a few clicks</p>
					</div>
				</div>
				<div class="col-md-4">
					<div class="text-center">
						<div class="feature-icon text-success" style="font-size: 2rem;">
							<i class="bi bi-shield-check-fill"></i>
							<span class="fallback-icon">ğŸ›¡ï¸</span>
						</div>
						<h5 class="mt-3 langCN">å®‰å…¨å¯é </h5>
						<h5 class="mt-3 langEN">Secure & Safe</h5>
						<p class="text-muted small langCN">å¼€æºé€æ˜ï¼Œæ•°æ®ä¸ä¼šå‘é€åˆ°ç¬¬ä¸‰æ–¹</p>
						<p class="text-muted small langEN">Open source, no data sent to third parties</p>
					</div>
				</div>
				<div class="col-md-4">
					<div class="text-center">
						<div class="feature-icon text-info" style="font-size: 2rem;">
							<i class="bi bi-globe"></i>
							<span class="fallback-icon">ğŸŒ</span>
						</div>
						<h5 class="mt-3 langCN">æ”¯æŒå¤šåŸŸå</h5>
						<h5 class="mt-3 langEN">Multi-Domain</h5>
						<p class="text-muted small langCN">æ”¯æŒé€šé…ç¬¦åŸŸåå’Œå¤šåŸŸåè¯ä¹¦</p>
						<p class="text-muted small langEN">Wildcard and multi-domain certificates</p>
					</div>
				</div>
			</div>

			<!-- é‡è¦æé†’ -->
			<div class="alert alert-warning mt-4" role="alert">
				<i class="bi bi-exclamation-triangle-fill me-2"></i>
				<strong class="langCN">é‡è¦æé†’ï¼š</strong>
				<strong class="langEN">Important:</strong>
				<span class="langCN">å…è´¹è¯ä¹¦æœ‰æ•ˆæœŸ90å¤©ï¼Œéœ€è¦æ‰‹åŠ¨ç»­æœŸ</span>
				<span class="langEN">Free certificates are valid for 90 days and require manual renewal</span>
			</div>
		</div>





		<!-- æ­¥éª¤ä¸€ï¼šé€‰æ‹©è¯ä¹¦é¢å‘æœºæ„ -->
		<div class="mainBox">
			<div class="itemTitle">
				<span class="langCN">æ­¥éª¤ä¸€ï¼šé€‰æ‹©è¯ä¹¦é¢å‘æœºæ„</span>
				<span class="langEN">Step 1: Select Certificate Authority</span>
			</div>

			<div class="itemBox">
				<h6 class="fw-bold mb-3">
					<span class="text-danger">*</span>
					<span class="langCN">é€‰æ‹©è¯ä¹¦é¢å‘æœºæ„ï¼š</span>
					<span class="langEN">Choose Certificate Authority:</span>
				</h6>

				<div class="row g-3">
					<div class="col-md-6">
						<div class="form-check p-3 border rounded hover-card">
							<input class="form-check-input" type="radio" name="choice_acmeURL"
								value="https://acme-v02.api.letsencrypt.org/directory" desckey="descLetsEncrypt"
								id="ca1">
							<label class="form-check-label w-100" for="ca1">
								<div class="d-flex align-items-center">
									<i class="bi bi-shield-check text-success me-2"></i>
									<strong>Let's Encrypt</strong>
								</div>
								<small class="text-muted langCN">æœ€å—æ¬¢è¿çš„å…è´¹è¯ä¹¦</small>
								<small class="text-muted langEN">Most popular free certificates</small>
							</label>
						</div>
					</div>
					<div class="col-md-6">
						<div class="form-check p-3 border rounded hover-card">
							<input class="form-check-input" type="radio" name="choice_acmeURL"
								value="https://acme.zerossl.com/v2/DV90/directory" desckey="descZeroSSL" id="ca2">
							<label class="form-check-label w-100" for="ca2">
								<div class="d-flex align-items-center">
									<i class="bi bi-shield-lock text-primary me-2"></i>
									<strong>ZeroSSL</strong>
								</div>
								<small class="text-muted langCN">éœ€è¦EABå‡­æ®</small>
								<small class="text-muted langEN">Requires EAB credentials</small>
							</label>
						</div>
					</div>
					<div class="col-md-6">
						<div class="form-check p-3 border rounded hover-card">
							<input class="form-check-input" type="radio" name="choice_acmeURL"
								value="https://dv.acme-v02.api.pki.goog/directory" desckey="descGoogle" id="ca3">
							<label class="form-check-label w-100" for="ca3">
								<div class="d-flex align-items-center">
									<i class="bi bi-google text-warning me-2"></i>
									<strong>Google Trust Services</strong>
								</div>
								<small class="text-muted langCN">éœ€è¦EABå‡­æ®</small>
								<small class="text-muted langEN">Requires EAB credentials</small>
							</label>
						</div>
					</div>
					<div class="col-md-6">
						<div class="form-check p-3 border rounded hover-card">
							<input class="form-check-input" type="radio" name="choice_acmeURL" value="manual" id="ca4">
							<label class="form-check-label w-100" for="ca4">
								<div class="d-flex align-items-center">
									<i class="bi bi-pencil-square text-secondary me-2"></i>
									<strong class="langCN">è‡ªå®šä¹‰URL</strong>
									<strong class="langEN">Custom URL</strong>
								</div>
								<small class="text-muted langCN">æ‰‹åŠ¨å¡«å†™ACMEæœåŠ¡åœ°å€</small>
								<small class="text-muted langEN">Manually enter ACME service URL</small>
							</label>
						</div>
					</div>
				</div>

				<div style="font-size:13px;color:#aaa">
					<div class="pd descAcmeURL descLetsEncrypt" style="display:none">
						<a href="https://letsencrypt.org/" target="_blank">Let's Encrypt</a>:
						<span class="langCN">è¯·æŒ‰ç…§ä¸‹é¢çš„æ“ä½œæ­¥éª¤æç¤ºè¿›è¡Œç”³è¯·å³å¯å¾—åˆ°è¯ä¹¦ï¼Œè¯ä¹¦æœ‰æ•ˆæœŸ90å¤©ã€‚</span>
						<span class="langEN">Please follow the operation steps prompts below to apply, and you can get
							the certificate, which is valid for 90 days.</span>
					</div>
					<div class="pd descAcmeURL descZeroSSL" style="display:none">
						<a href="https://zerossl.com/" target="_blank">ZeroSSL</a>:
						<span style="color:#f80">
							<span class="langCN">æ­¤URLå¯èƒ½éœ€è¦å…ˆæ ¹æ®ä¸‹é¢çš„æç¤ºè¿›è¡Œæ“ä½œæ¥æ¶ˆé™¤è·¨åŸŸä¸èƒ½è®¿é—®çš„é—®é¢˜ã€‚</span>
							<span class="langEN">This URL may need to be operated according to the prompts below to
								eliminate the problem of cross-domain inaccessibility.</span>
						</span>
						<span class="langCN">ç”³è¯·è¯ä¹¦å‰ï¼Œä½ éœ€è¦æ ¹æ®ZeroSSLçš„<a href="https://zerossl.com/documentation/acme/"
								target="_blank">å®˜æ–¹æ–‡æ¡£</a>ï¼Œå…ˆæ³¨å†ŒZeroSSLè´¦å·å¹¶ç”Ÿæˆä¸€ä¸ªEABå‡­æ®ï¼Œæ¯æ¬¡ç”³è¯·è¯ä¹¦æ—¶ä½¿ç”¨æ­¤EABå‡­æ®ï¼ŒæŒ‰ç…§ä¸‹é¢çš„æ“ä½œæ­¥éª¤æç¤ºè¿›è¡Œç”³è¯·å³å¯å¾—åˆ°è¯ä¹¦ï¼Œè¯ä¹¦æœ‰æ•ˆæœŸ90å¤©ã€‚</span>
						<span class="langEN">Before applying for a certificate, you need to follow ZeroSSL's <a
								href="https://zerossl.com/documentation/acme/" target="_blank">official documents</a>,
							register a ZeroSSL account and generate an EAB credential, and use this EAB credential every
							time you apply for a certificate, follow the operation steps prompts below to apply, and you
							can get the certificate, which is valid for 90 days.</span>
					</div>
					<div class="pd descAcmeURL descGoogle" style="display:none">
						<a href="https://pki.goog/" target="_blank">Google Trust Services</a>:
						<span style="color:#f80">
							<span class="langCN">æ­¤URLå¯èƒ½éœ€è¦å…ˆæ ¹æ®ä¸‹é¢çš„æç¤ºè¿›è¡Œæ“ä½œæ¥æ¶ˆé™¤è·¨åŸŸä¸èƒ½è®¿é—®çš„é—®é¢˜ã€‚</span>
							<span class="langEN">This URL may need to be operated according to the prompts below to
								eliminate the problem of cross-domain inaccessibility.</span>
						</span>
						<span class="langCN">ç”³è¯·è¯ä¹¦å‰ï¼Œä½ éœ€è¦æ ¹æ®Googleçš„<a
								href="https://cloud.google.com/certificate-manager/docs/public-ca-tutorial"
								target="_blank">å®˜æ–¹æ–‡æ¡£</a>ï¼Œåœ¨Google
							Cloudä¸­ç”Ÿæˆä¸€ä¸ªEABå‡­æ®ï¼Œæ¯æ¬¡ç”³è¯·è¯ä¹¦æ—¶ä½¿ç”¨æ­¤EABå‡­æ®ï¼ŒæŒ‰ç…§ä¸‹é¢çš„æ“ä½œæ­¥éª¤æç¤ºè¿›è¡Œç”³è¯·å³å¯å¾—åˆ°è¯ä¹¦ï¼Œè¯ä¹¦æœ‰æ•ˆæœŸ90å¤©ã€‚</span>
						<span class="langEN">Before applying for a certificate, you need to follow Google's <a
								href="https://cloud.google.com/certificate-manager/docs/public-ca-tutorial"
								target="_blank">official documents</a>, generate an EAB credential in Google Cloud, and
							use this EAB credential every time you apply for a certificate, follow the operation steps
							prompts below to apply, and you can get the certificate, which is valid for 90 days.</span>
						<span style="color:#f80">
							<span class="langCN">æ³¨æ„ï¼šå› ä¸ºåŒä¸€ä¸ªGoogle EABå‡­æ®åªèƒ½ç»‘å®šåˆ°ä¸€ä¸ªACMEè´¦æˆ·ï¼ˆç§é’¥ï¼‰ï¼Œå› æ­¤ä½ åœ¨é¦–æ¬¡ç”³è¯·è¯ä¹¦æ—¶ï¼Œ<span
									style="font-weight:bold;font-size:20px">å¿…é¡»åŒæ—¶ä¿å­˜å¥½åœ¨ç¬¬äºŒæ­¥æ“ä½œä¸­æ–°åˆ›å»ºçš„æˆ–æ‰‹åŠ¨å¡«å†™çš„ACMEè´¦æˆ·ç§é’¥</span>ï¼Œä¸‹æ¬¡ç”³è¯·è¯ä¹¦æ—¶ä½¿ç”¨æ­¤EABå‡­æ®å¿…é¡»å’Œå·²ä¿å­˜çš„ACMEè´¦æˆ·ç§é’¥ä¸€èµ·ä½¿ç”¨ã€‚</span>
							<span class="langEN">Note: Because the same Google EAB credential can only be bound to one
								ACME account (Private key), when you apply for a certificate for the first time, <span
									style="font-weight:bold;font-size:20px">you must also save the newly generated or
									manually filled ACME account private key in the second step</span>, this EAB
								credential must be used together with the saved ACME account private key when applying
								for a certificate next time.</span>
						</span>
					</div>
				</div>

				<div class="mt-4">
					<div class="input-group">
						<input class="form-control in_acmeURL inputLang" placeholder-cn="è¯·å¡«å†™è¯ä¹¦é¢å‘æœºæ„ACMEæœåŠ¡URL"
							placeholder-en="Please fill in the Certificate Authority ACME Service URL">
						<button class="btn btn-primary mainBtn" onclick="acmeReadDirClick()" type="button">
							<i class="bi bi-arrow-clockwise me-2"></i>
							<span class="langCN">è¯»å–æœåŠ¡ç›®å½•</span>
							<span class="langEN">Read Directory</span>
						</button>
					</div>
				</div>
				<div class="acmeReadDirState mt-3"></div>
				<script>
					//è·¨åŸŸæ”¯æŒçš„ä¸å¥½çš„ACMEæœåŠ¡ï¼Œç›´æ¥å¤åˆ¶æºç åˆ°ä»–ä»¬ç½‘ç«™é‡Œé¢è¿è¡Œ
					var acmeReadDirGotoCORSInit = function () {
						if (!window.IsReadDirGotoCORS) return;
						var stateEl = $(".acmeReadDirGotoCORSState").show().html(`
<div style="color:#cb1d1d">
	<span class="langCN">æœ¬å®¢æˆ·ç«¯æ­£åœ¨ä»¥è·¨åŸŸå…¼å®¹æ¨¡å¼è¿è¡Œï¼Œè¯·æŒ‰æ­£å¸¸æµç¨‹æ“ä½œå³å¯ï¼Œç›®æ ‡ACMEæœåŠ¡URL=${window.Default_ACME_URL}</span>
	<span class="langEN">This client is running in cross-domain compatibility mode, please follow the normal process, the target ACME service URL=${window.Default_ACME_URL}</span>
</div>
	`);
						LangReview(stateEl);
					};
					var acmeReadDirGotoCORS = function (title) {
						"use strict";
						var codes = "// " + Lang("è¯·å¤åˆ¶æœ¬ä»£ç åˆ°æ‰“å¼€çš„ACMEæœåŠ¡URLé¡µé¢çš„æµè§ˆå™¨æ§åˆ¶å°ä¸­è¿è¡Œã€‚", "Please copy this code to the browser console of the opened ACME service URL page to run.", true)
							+ "\n\nvar Default_ACME_URL=" + JSON.stringify(ACME.URL) + ";"
							+ "\nvar IsReadDirGotoCORS=true;"
							+ "\nvar PageRawHTML=`"
							+ PageRawHTML.replace(/\\/g, "\\\\").replace(/`/g, "\\`").replace(/\$\{/g, "$\\{")
							+ "`;";
						codes += "\nvar PageErrs=" + JSON.stringify({
							e0: Lang("è¿è¡Œå¤±è´¥ï¼Œå¯èƒ½æ˜¯æ­¤æµè§ˆå™¨é˜»æ­¢äº†ä»£ç æ‰§è¡Œï¼Œè¯·å°è¯•æ¢ä¸ªæµè§ˆå™¨ã€‚", "Run failed, may be because the browser blocked the code execution, please try another browser.", true)
							, e1: Lang("è¿è¡Œå¤±è´¥ï¼Œè§£å†³åŠæ³•ï¼šå³å°†è‡ªåŠ¨è·³è½¬åˆ°æ­¤ç«™ç‚¹çš„é¦–é¡µæˆ–404é¡µï¼Œç„¶åè¯·å†æ¬¡ç²˜è´´ä»£ç è¿è¡Œ", "Run failed, solution: automatically jump to the homepage or 404 page of this site, then paste the code again to run", true)
						}) + ";";
						codes += "\n(" + (function () {
							console.clear();
							try {
								document.head.innerHTML = /<head[^>]*>([\S\s]+?)<\/head>/i.exec(PageRawHTML)[1];
								document.body.innerHTML = /<body[^>]*>([\S\s]+)<\/body>/i.exec(PageRawHTML)[1];
								var js = /<script[^>]*>([\S\s]+?)<\/script>/ig, m;
								while (m = js.exec(PageRawHTML)) eval.call(window, m[1]);
								ACME.Directory.toString(); //ä¿è¯jså·²æ­£ç¡®æ‰§è¡Œ
							} catch (e) {
								setTimeout(function () { //éƒ¨åˆ†æµè§ˆå™¨jsoné¡µé¢æ— æ³•æ˜¾ç¤ºï¼Œè·³è½¬åˆ°æ ¹ç›®å½•é‡è¯•
									console.error(e);
									var url0 = location.href, url = /^(.+\/\/[^\/\?#]+)/.exec(url0)[1];
									if (url == url0 || url + "/" == url0) return console.error(PageErrs.e0);
									console.log(PageErrs.e1); console.warn(PageErrs.e1); console.error(PageErrs.e1);
									alert(PageErrs.e1); location.href = url;
								});
							}
						}).toString() + ")();\n";
						$(".gotoCORSBox").hide();
						var stateEl = $(".acmeReadDirState").append(`
<div class="gotoCORSBox" style="padding-top:15px">
	<div class="pd Bold" style="color:red">
		<i class="must">*</i>
		`+ (title || `
		<span class="langCN">ç”±äºæ­¤ACMEæœåŠ¡å¯¹è·¨åŸŸè®¿é—®æ”¯æŒä¸è‰¯ï¼Œ</span>
		<span class="langEN">Because this ACME service has poor support for cross-domain access, </span>
		<span style="font-size:24px">
			<span class="langCN">è¯·æŒ‰ä¸‹é¢æ­¥éª¤æ“ä½œï¼š</span>
			<span class="langEN">please follow the steps below:</span>
		</span>`) + `
	</div>
<div style="padding-left:40px">
	<div class="pd">
		<span class="langCN">1. è¯·åœ¨æµè§ˆå™¨ä¸­ç›´æ¥æ‰“å¼€æ­¤ACMEæœåŠ¡URLï¼Œ<a href="${ACME.URL}" target="_blank">ç‚¹æ­¤æ‰“å¼€</a>ï¼›</span>
		<span class="langEN">1. Please open the ACME service URL directly in the browser, <a href="${ACME.URL}" target="_blank">click here to open</a>;</span>
	</div>
	<div class="pd">
		<span class="langCN">2. åœ¨ä¸Šä¸€æ­¥æ‰“å¼€çš„é¡µé¢ä¸­æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆéœ€ç­‰é¡µé¢åŠ è½½å®Œæˆåï¼Œå†æŒ‰F12é”®ï¼‰ï¼›</span>
		<span class="langEN">2. Open the browser console in the page opened in the previous step (after the page is loaded, press the F12 key);</span>
	</div>
	<div class="pd">
		<span class="langCN">3. å¤åˆ¶ä»¥ä¸‹ä»£ç ï¼Œåœ¨ç¬¬2æ­¥æ‰“å¼€çš„æµè§ˆå™¨æ§åˆ¶å°ä¸­è¿è¡Œï¼Œç„¶åå°±å¯ä»¥æ­£å¸¸ç”³è¯·è¯ä¹¦äº†ã€‚</span>
		<span class="langEN">3. Copy the following code, run it in the browser console opened in step 2, and then you can apply for the certificate normally.</span>
	</div>
	<div class="pd" style="font-size:13px;color:#aaa">
		<span class="langCN">å·¥ä½œåŸç†ï¼šä»£ç å†…åŒ…å«äº†æœ¬é¡µé¢æºç ï¼Œåœ¨ç›®æ ‡é¡µé¢å†…è¿è¡Œåå°†åŸæ ·çš„æ˜¾ç¤ºå‡ºæœ¬å®¢æˆ·ç«¯ï¼Œç„¶åæŒ‰æ­£å¸¸æµç¨‹æ“ä½œå³å¯ï¼Œæ­¤æ—¶å·²æ²¡æœ‰è·¨åŸŸé—®é¢˜äº†ï¼ˆæ—¢ç„¶æ‰“ä¸è¿‡ï¼Œé‚£å°±åŠ å…¥ä»–ä»¬ï¼‰ã€‚</span>
		<span class="langEN">Working principle: The code contains the source code of this page. After running in the target page, the client will be displayed as it is, and then operate according to the normal process. At this time, there is no cross-domain problem (if we can't beat them, we'd better join them).</span>
	</div>
</div>
	<div style="padding-top:20px">
		<textarea class="gotoCORSText" style="width:100%;height:200px" readonly></textarea>
	</div>
</div>
	`);
						$(".gotoCORSText").val(codes);
						LangReview(stateEl);
					};
				</script>
			</div>
		</div>





		<!-- æ­¥éª¤äºŒï¼šè¯ä¹¦é…ç½® -->
		<div class="mainBox">
			<div class="itemTitle">
				<span class="langCN">æ­¥éª¤äºŒï¼šè¯ä¹¦é…ç½®</span>
				<span class="langEN">Step 2: Certificate Configuration</span>
			</div>

			<div class="step2Hide step1Show">
				<div class="alert alert-info" role="alert">
					<i class="bi bi-clock me-2"></i>
					<span class="langCN">ç­‰å¾…ä¸­ï¼Œè¯·å…ˆå®Œæˆç¬¬ä¸€æ­¥...</span>
					<span class="langEN">Waiting, please complete step 1 first...</span>
				</div>
			</div>

			<div class="step1Hide step2Show">
				<!-- æç¤ºä¿¡æ¯ -->
				<div class="alert alert-info" role="alert">
					<i class="bi bi-info-circle me-2"></i>
					<span class="langCN">æç¤ºï¼šå¯ä»¥æ‹–æ‹½LOGæ–‡ä»¶åˆ°é¡µé¢è‡ªåŠ¨å¡«å……é…ç½®</span>
					<span class="langEN">Tip: Drag LOG file to page to auto-fill configuration</span>
				</div>

				<!-- åŸŸåé…ç½® -->
				<div class="itemBox">
					<h6 class="fw-bold mb-3">
						<span class="text-danger">*</span>
						<i class="bi bi-globe me-2"></i>
						<span class="langCN">è¯ä¹¦åŸŸåï¼š</span>
						<span class="langEN">Certificate Domains:</span>
					</h6>

					<div class="mb-3">
						<small class="text-muted">
							<span class="langCN">æ”¯æŒå¤šåŸŸåå’Œé€šé…ç¬¦ï¼Œä¾‹å¦‚ï¼š<code>example.com, *.example.com</code></span>
							<span class="langEN">Supports multiple domains and wildcards, e.g.:
								<code>example.com, *.example.com</code></span>
						</small>
					</div>

					<div class="input-group">
						<span class="input-group-text">
							<i class="bi bi-globe"></i>
						</span>
						<input class="form-control in_domains inputLang" placeholder-cn="è¯·å¡«å†™ä½ çš„åŸŸåï¼Œå¤šä¸ªç”¨é€—å·éš”å¼€"
							placeholder-en="Enter your domains, separated by commas">
						<div class="input-group-text">
							<div class="form-check">
								<input class="form-check-input choice_domains_store" type="checkbox"
									id="rememberDomains">
								<label class="form-check-label" for="rememberDomains">
									<small class="langCN">è®°ä½</small>
									<small class="langEN">Remember</small>
								</label>
							</div>
						</div>
					</div>
				</div>

				<!-- è¯ä¹¦ç§é’¥é…ç½® -->
				<div class="itemBox">
					<h6 class="fw-bold mb-3">
						<span class="text-danger">*</span>
						<i class="bi bi-key me-2"></i>
						<span class="langCN">è¯ä¹¦ç§é’¥ï¼š</span>
						<span class="langEN">Certificate Private Key:</span>
					</h6>

					<div class="alert alert-warning" role="alert">
						<i class="bi bi-exclamation-triangle me-2"></i>
						<small>
							<span class="langCN">ç§é’¥ç±»å‹å†³å®šè¯ä¹¦ç±»å‹ï¼ŒRSAå…¼å®¹æ€§æ›´å¥½</span>
							<span class="langEN">Key type determines certificate type, RSA has better
								compatibility</span>
						</small>
					</div>

					<div class="row g-3 mb-3">
						<div class="col-md-4">
							<div class="form-check p-3 border rounded hover-card">
								<input class="form-check-input" type="radio" name="choice_privateKey"
									value="generateRSA" id="key1">
								<label class="form-check-label w-100" for="key1">
									<div class="d-flex align-items-center">
										<i class="bi bi-cpu text-primary me-2"></i>
										<strong class="langCN">ç”ŸæˆRSAç§é’¥</strong>
										<strong class="langEN">Generate RSA Key</strong>
									</div>
									<small class="text-muted langCN">æ¨èï¼Œå…¼å®¹æ€§æœ€å¥½</small>
									<small class="text-muted langEN">Recommended, best compatibility</small>
								</label>
							</div>
						</div>
						<div class="col-md-4">
							<div class="form-check p-3 border rounded hover-card">
								<input class="form-check-input" type="radio" name="choice_privateKey"
									value="generateECC" id="key2">
								<label class="form-check-label w-100" for="key2">
									<div class="d-flex align-items-center">
										<i class="bi bi-lightning text-warning me-2"></i>
										<strong class="langCN">ç”ŸæˆECCç§é’¥</strong>
										<strong class="langEN">Generate ECC Key</strong>
									</div>
									<small class="text-muted langCN">æ›´å¿«ï¼Œæ›´å°</small>
									<small class="text-muted langEN">Faster, smaller</small>
								</label>
							</div>
						</div>
						<div class="col-md-4">
							<div class="form-check p-3 border rounded hover-card">
								<input class="form-check-input" type="radio" name="choice_privateKey" value="manual"
									id="key3">
								<label class="form-check-label w-100" for="key3">
									<div class="d-flex align-items-center">
										<i class="bi bi-pencil text-secondary me-2"></i>
										<strong class="langCN">æ‰‹åŠ¨å¡«å†™</strong>
										<strong class="langEN">Manual Input</strong>
									</div>
									<small class="text-muted langCN">ä½¿ç”¨ç°æœ‰ç§é’¥</small>
									<small class="text-muted langEN">Use existing key</small>
								</label>
							</div>
						</div>
					</div>

					<div class="privateKeyBox">
						<textarea class="form-control in_privateKey inputLang" rows="4"
							placeholder-cn="è¯·å¡«å†™PEMæ ¼å¼ç§é’¥ï¼Œä»¥ -----BEGIN PRIVATE KEY----- å¼€å¤´"
							placeholder-en="Enter PEM format private key, starting with -----BEGIN PRIVATE KEY-----"></textarea>
					</div>
					<div class="privateKeyState mt-2"></div>
				</div>

				<!-- ACMEè´¦æˆ·ç§é’¥é…ç½® -->
				<div class="itemBox">
					<h6 class="fw-bold mb-3">
						<span class="text-danger">*</span>
						<i class="bi bi-person-key me-2"></i>
						<span class="langCN">ACMEè´¦æˆ·ç§é’¥ï¼š</span>
						<span class="langEN">ACME Account Key:</span>
					</h6>

					<div class="alert alert-info" role="alert">
						<i class="bi bi-info-circle me-2"></i>
						<small>
							<span class="langCN">å»ºè®®é‡å¤ä½¿ç”¨åŒä¸€ç§é’¥ï¼Œä¾¿äºç®¡ç†è¯ä¹¦</span>
							<span class="langEN">Recommend reusing the same key for easier certificate management</span>
						</small>
					</div>

					<div class="eabShow alert alert-warning" role="alert">
						<i class="bi bi-exclamation-triangle me-2"></i>
						<small>
							<span class="langCN">æ³¨æ„ï¼šä½¿ç”¨EABå‡­æ®æ—¶å¿…é¡»ä½¿ç”¨ç›¸åŒçš„è´¦æˆ·ç§é’¥</span>
							<span class="langEN">Note: Must use the same account key when using EAB credentials</span>
						</small>
					</div>

					<div class="row g-3 mb-3">
						<div class="col-md-4">
							<div class="form-check p-3 border rounded hover-card">
								<input class="form-check-input" type="radio" name="choice_accountKey"
									value="generateRSA" id="acckey1">
								<label class="form-check-label w-100" for="acckey1">
									<div class="d-flex align-items-center">
										<i class="bi bi-cpu text-primary me-2"></i>
										<strong class="langCN">ç”ŸæˆRSAç§é’¥</strong>
										<strong class="langEN">Generate RSA Key</strong>
									</div>
								</label>
							</div>
						</div>
						<div class="col-md-4">
							<div class="form-check p-3 border rounded hover-card">
								<input class="form-check-input" type="radio" name="choice_accountKey"
									value="generateECC" id="acckey2">
								<label class="form-check-label w-100" for="acckey2">
									<div class="d-flex align-items-center">
										<i class="bi bi-lightning text-warning me-2"></i>
										<strong class="langCN">ç”ŸæˆECCç§é’¥</strong>
										<strong class="langEN">Generate ECC Key</strong>
									</div>
								</label>
							</div>
						</div>
						<div class="col-md-4">
							<div class="form-check p-3 border rounded hover-card">
								<input class="form-check-input" type="radio" name="choice_accountKey" value="manual"
									id="acckey3">
								<label class="form-check-label w-100" for="acckey3">
									<div class="d-flex align-items-center">
										<i class="bi bi-pencil text-secondary me-2"></i>
										<strong class="langCN">æ‰‹åŠ¨å¡«å†™</strong>
										<strong class="langEN">Manual Input</strong>
									</div>
								</label>
							</div>
						</div>
					</div>

					<div class="accountKeyBox">
						<textarea class="form-control in_accountKey inputLang" rows="4"
							placeholder-cn="è¯·å¡«å†™PEMæ ¼å¼ç§é’¥ï¼Œä»¥ -----BEGIN PRIVATE KEY----- å¼€å¤´"
							placeholder-en="Enter PEM format private key, starting with -----BEGIN PRIVATE KEY-----"></textarea>
					</div>
					<div class="accountKeyState mt-2"></div>
				</div>

				<!-- è”ç³»é‚®ç®±é…ç½® -->
				<div class="itemBox">
					<h6 class="fw-bold mb-3">
						<span class="text-danger">*</span>
						<i class="bi bi-envelope me-2"></i>
						<span class="langCN">è”ç³»é‚®ç®±ï¼š</span>
						<span class="langEN">Contact Email:</span>
					</h6>

					<div class="mb-3">
						<small class="text-muted">
							<span class="langCN">ç”¨äºæ¥æ”¶è¯ä¹¦è¿‡æœŸæé†’ç­‰é€šçŸ¥</span>
							<span class="langEN">For receiving certificate expiration reminders and notifications</span>
						</small>
					</div>

					<div class="input-group">
						<span class="input-group-text">
							<i class="bi bi-envelope"></i>
						</span>
						<input class="form-control in_email inputLang" type="email" placeholder-cn="è¯·å¡«å†™ä½ çš„é‚®ç®±åœ°å€"
							placeholder-en="Enter your email address">
						<div class="input-group-text">
							<div class="form-check">
								<input class="form-check-input choice_email_store" type="checkbox" id="rememberEmail">
								<label class="form-check-label" for="rememberEmail">
									<small class="langCN">è®°ä½</small>
									<small class="langEN">Remember</small>
								</label>
							</div>
						</div>
					</div>
				</div>

				<!-- EABå‡­æ®é…ç½® -->
				<div class="itemBox eabShow">
					<h6 class="fw-bold mb-3">
						<i class="bi bi-key-fill me-2"></i>
						<span class="langCN">EABå‡­æ®ï¼š</span>
						<span class="langEN">EAB Credentials:</span>
					</h6>

					<div class="alert alert-info" role="alert">
						<i class="bi bi-info-circle me-2"></i>
						<small>
							<span class="langCN">éœ€è¦åœ¨è¯ä¹¦é¢å‘æœºæ„æ§åˆ¶å°è·å–EABå‡­æ®</span>
							<span class="langEN">Need to obtain EAB credentials from CA console</span>
						</small>
					</div>

					<div class="row g-3">
						<div class="col-md-6">
							<label class="form-label">
								<span class="text-danger">*</span>
								<strong>EAB KID:</strong>
							</label>
							<input class="form-control in_eab_kid inputLang" placeholder-cn="è¯·å¡«å†™EAB KID"
								placeholder-en="Enter EAB KID">
						</div>
						<div class="col-md-6">
							<label class="form-label">
								<span class="text-danger">*</span>
								<strong>HMAC KEY:</strong>
							</label>
							<input class="form-control in_eab_key inputLang" placeholder-cn="è¯·å¡«å†™EAB HMAC KEY"
								placeholder-en="Enter EAB HMAC KEY">
						</div>
					</div>
				</div>

				<!-- æœåŠ¡æ¡æ¬¾åŒæ„ -->
				<div class="termsAgreeBox">
					<div class="form-check">
						<input class="form-check-input choice_termsAgree" type="checkbox" id="termsAgree">
						<label class="form-check-label" for="termsAgree">
							<span class="termsAgreeTips"></span>
						</label>
					</div>
				</div>

				<!-- ç¡®å®šæŒ‰é’® -->
				<div class="text-center mt-4">
					<button class="btn btn-primary btn-lg px-5" onclick="configStepClick()">
						<i class="bi bi-check-circle me-2"></i>
						<span class="langCN">å¼€å§‹é…ç½®</span>
						<span class="langEN">Start Configuration</span>
					</button>
				</div>
				<div class="configStepState mt-3"></div>

			</div>
		</div>






		<div class="mainBox">
			<div class="pd itemTitle">
				<span class="langCN">æ­¥éª¤ä¸‰ï¼šéªŒè¯åŸŸåæ‰€æœ‰æƒ</span>
				<span class="langEN">Step 3: Verify Domain Ownership</span>
			</div>
			<div class="step3Hide step2Show step1Show">
				<div class="itemBox" style="color:#999">
					<span class="langCN">ç­‰å¾…ä¸­ï¼Œè¯·å…ˆå®Œæˆç¬¬äºŒæ­¥...</span>
					<span class="langEN">Waiting, please complete step 2 first...</span>
				</div>
			</div>
			<div class="step1Hide step2Hide step3Show">

				<div class="pd" style="font-size:13px;color:#f80">
					<span class="langCN">è¯·ç»™æ¯ä¸ªåŸŸåé€‰æ‹©ä¸€ä¸ªä½ åˆé€‚çš„éªŒè¯æ–¹å¼ï¼ˆæ¨èé‡‡ç”¨DNSéªŒè¯ï¼Œæ¯”è¾ƒç®€å•å’Œé€šç”¨ï¼‰ï¼Œç„¶åæ ¹æ®æ˜¾ç¤ºçš„æç¤ºå®Œæˆå¯¹åº”çš„é…ç½®æ“ä½œã€‚</span>
					<span class="langEN">Please select a suitable verification method for each domain name (DNS Verify
						is recommended, which is relatively simple and common), and then complete the corresponding
						configuration operations according to the displayed prompts.</span>
				</div>

				<div class="verifyBox"></div>
				<script>
					//æ˜¾ç¤ºæ‰€æœ‰åŸŸåçš„éªŒè¯ç•Œé¢ï¼Œhtmlå¤ªå¤š
					var verifyBoxShow = function () {
						"use strict";
						var boxEl = $(".verifyBox").html("");
						var auths = JSON.parse(JSON.stringify(ACME.StepData.auths));//é¿å…æ”¹åŠ¨åŸå§‹æ•°æ®
						var domains = ACME.StepData.config.domains;
						for (var i0 = 0; i0 < domains.length; i0++) {
							var domain = domains[i0], auth = auths[domain]

							var challs = auth.challenges;
							for (var i = 0; i < challs.length; i++) {//æ’åºï¼Œdnsæ’å‰é¢
								var o = challs[i];
								o.challIdx = i;
								o.name = ACME.ChallName(o);
								o._sort = ACME.ChallSort(o);
							}
							challs.sort(function (a, b) { return a._sort.localeCompare(b._sort) });
							var choiceHtml = "";
							for (var i = 0; i < challs.length; i++) {
								var chall = challs[i];
								choiceHtml += `
<label>
	<input type="radio" name="choice_authItem_${i0}"
		class="choice_authChall choice_authChall_${i0} choice_authChall_${i0}_${i}"
		value="${i0}_${i}" challidx="${chall.challIdx}">${chall.name}
</label>
			`;
							}

							boxEl.append(`
<div class="itemBox">
	<div class="pd FlexBox" style="line-height:26px">
		<div><i class="must">*</i></div>
		<div style="width:180px;padding-right:5px;text-align:right;background:#03baed;color:#fff;border-radius: 4px;">${domain}</div>
		<div class="FlexItem" style="padding-left:10px;">${choiceHtml}</div>
	</div>
	<div class="verifyItemBox_${i0}"></div>
	<div class="verifyItemState_${i0}"></div>
</div>
		`);
						};
						LangReview(boxEl);

						$(".choice_authChall").bind("click", function (e) {
							var el = e.target, vals = el.value.split("_"), i0 = +vals[0], i2 = +vals[1];
							var domain = domains[i0], auth = auths[domain], chall = auth.challenges[i2];
							var html = ['<div class="pd" style="padding-left:10px;font-size:13px;color:#aaa">'];
							var nameCss = 'width:195px;text-align:right;padding-right:10px';
							if (chall.type == "dns-01") {
								html.push(Lang('è¯·åˆ°ä½ çš„åŸŸåDNSè§£æç®¡ç†ä¸­ï¼Œç»™ä¸‹é¢è¿™ä¸ªå­åŸŸåå¢åŠ ä¸€æ¡<i class="i">TXTè®°å½•</i>ï¼ˆä¸€ä¸ªå­åŸŸåå¯ä»¥åŒæ—¶å­˜åœ¨å¤šæ¡TXTè®°å½•ï¼Œå¯ä»¥ä¿®æ”¹æˆ–åˆ é™¤è€çš„è®°å½•ï¼‰ã€‚', 'Please go to the DNS resolution management of your domain name and add a <i class="i">TXT record</i> for the following subdomain name (a subdomain name can have multiple TXT records at the same time, and the old records can be modified or deleted).') + '</div>');
								html.push(`<div class="pd FlexBox">
				<div style="${nameCss}">${Lang('å­åŸŸå', 'Sub Domain')}:</div>
				<div class="FlexItem">
					<input style="width:100%" readonly value="_acme-challenge.${auth.identifier.value}" />
				</div>
			</div>
			<div class="pd FlexBox">
				<div style="${nameCss}">${Lang('TXTè®°å½•', 'TXT Record')}:</div>
				<div class="FlexItem">
					<input style="width:100%" readonly value="${chall.authTxtSHA256}" />
				</div>
			</div>`);
							} else if (chall.type == "http-01") {
								html.push(Lang('è¯·åœ¨ä½ çš„ç½‘ç«™æ ¹ç›®å½•ä¸­åˆ›å»º<i class="i">/.well-known/acme-challenge/</i>ç›®å½•ï¼Œç›®å½•å†…åˆ›å»º<i class="i">' + FormatText(chall.token) + '</i>æ–‡ä»¶ï¼Œæ–‡ä»¶å†…ä¿å­˜ä¸‹é¢çš„æ–‡ä»¶å†…å®¹ï¼Œä¿å­˜å¥½å<a href="http://' + auth.identifier.value + '/.well-known/acme-challenge/' + FormatText(chall.token) + '" target="_blank">è¯·ç‚¹æ­¤æ‰“å¼€æ­¤æ–‡ä»¶URL</a>æµ‹è¯•èƒ½å¦æ­£å¸¸è®¿é—®ï¼›æ³¨æ„ï¼šè¿™ä¸ªæ–‡ä»¶URLå¿…é¡»æ˜¯80ç«¯å£ï¼Œå¹¶ä¸”å…¬ç½‘å¯ä»¥è®¿é—®ï¼Œå¦åˆ™ACMEæ— æ³•è®¿é—®åˆ°æ­¤åœ°å€å°†ä¼šéªŒè¯å¤±è´¥ã€‚Windowsæ“ä½œæç¤ºï¼šWindowsä¸­ç”¨<i class="i">.well-known.</i>ä½œä¸ºæ–‡ä»¶å¤¹åç§°å°±èƒ½åˆ›å»º<i class="i">.well-known</i>æ–‡ä»¶å¤¹ï¼›IISå¯èƒ½éœ€åœ¨æ­¤æ–‡ä»¶å¤¹ä¸‹çš„MIMEç±»å‹ä¸­ç»™ <i class="i">.</i> ï¼ˆæ‰©å±•åå°±æ˜¯ä¸€ä¸ªå­—"."ï¼‰æ·»åŠ  <i class="i">text/plain</i> æ‰èƒ½æ­£å¸¸è®¿é—®ã€‚', 'Please create the <i class="i">/.well-known/acme-challenge/</i> directory in the root directory of your website, create the <i class="i">' + FormatText(chall.token) + '</i> file in the directory, and save the following file content in the file; After saving, <a href="http://' + auth.identifier.value + '/.well-known/acme-challenge/' + FormatText(chall.token) + '" target="_blank">please click here to open the URL</a> of this file to test whether Normal access; note: the URL of this file must be 80 The port and the public network can be accessed, otherwise ACME cannot access this address and the verification will fail. Windows operation tips: In Windows, you can create a <i class="i">.well-known</i> folder by using <i class="i">.well-known.</i> as the folder name; IIS may need to give <i class="i">.</i> in the MIME type under this folder (the extension is a word ".") Add <i class="i">text/plain</i> for normal access.') + '</div>');
								html.push(`<div class="pd FlexBox">
				<div style="${nameCss}">${Lang('æ–‡ä»¶URL', 'File URL')}:</div>
				<div class="FlexItem">
					<input style="width:100%" readonly value="http://${auth.identifier.value}/.well-known/acme-challenge/${FormatText(chall.token)}" />
				</div>
			</div>
			<div class="pd FlexBox">
				<div style="${nameCss}">${Lang('æ–‡ä»¶å†…å®¹', 'File Content')}:</div>
				<div class="FlexItem">
					<input style="width:100%" readonly value="${chall.authTxt}" />
				</div>
			</div>`);
							} else {
								html.push(Lang('éé¢„å®šä¹‰éªŒè¯ç±»å‹ï¼Œè¯·ä½¿ç”¨<i class="i">Key Authorizations (Token+.+æŒ‡çº¹)</i>è‡ªè¡Œå¤„ç†ï¼Œ<i class="i">Digest</i>ä¸ºKey Authorizationsçš„SHA-256 Base64å€¼ã€‚', 'For non-predefined authentication types, please use <i class="i">Key Authorizations (Token+.+Thumbprint)</i> to handle it yourself. <i class="i">Digest</i> is the SHA-256 Base64 value of Key Authorizations.') + '</div>');
								html.push(`<div class="pd FlexBox">
				<div style="${nameCss}">Key Authorizations:</div>
				<div class="FlexItem">
					<input style="width:100%" readonly value="${chall.authTxt}" />
				</div>
			</div>
			<div class="pd FlexBox">
				<div style="${nameCss}">Digest(SHA-256 Base64):</div>
				<div class="FlexItem">
					<input style="width:100%" readonly value="${chall.authTxtSHA256Base64}" />
				</div>
			</div>`);
							}
							$(".verifyItemBox_" + i0).html(html.join('\n'));
						});
						for (var i0 = 0; i0 < domains.length; i0++) {
							var el = $(".choice_authChall_" + i0 + "_0");
							el[0] && el[0].click(); //é»˜è®¤é€‰ä¸­æ¯ä¸ªåŸŸåçš„ç¬¬ä¸€ä¸ª
						}
					};
				</script>

				<div class="itemBox">
					<div class="pd" style="font-size:15px">
						<span class="langCN">è¯·æ¯ä¸ªåŸŸåé€‰æ‹©å¥½å¯¹åº”çš„éªŒè¯æ–¹å¼ï¼Œæ ¹æ®æ˜¾ç¤ºçš„æç¤ºè¿›è¡Œå¯¹åº”çš„é…ç½®æ“ä½œï¼›<span
								style="color:#cb1d1d">å¿…é¡»æ‰€æœ‰åŸŸåé…ç½®å®Œæˆåï¼Œå†æ¥ç‚¹å‡»ä¸‹é¢çš„â€œå¼€å§‹éªŒè¯â€æŒ‰é’®è¿›è¡ŒéªŒè¯ï¼Œ</span>å¦‚æœéªŒè¯å¤±è´¥ï¼Œéœ€è¦è¿”å›ç¬¬äºŒæ­¥é‡æ–°å¼€å§‹æ“ä½œã€‚</span>
						<span class="langEN">Please select the corresponding verify method for each domain name, and
							perform the corresponding configuration operation according to the displayed prompts; <span
								style="color:#cb1d1d">after all domain names are configured, click the "Start Verify"
								button below to verify,</span> if the verify fails, you need to go back to the step 2
							Start the operation.</span>
					</div>

					<div class="Center" style="padding:15px 0 10px">
						<span class="mainBtn verifyStepBtn" onclick="verifyStepClick()" style="width:300px">
							<span class="langCN">å¼€å§‹éªŒè¯</span>
							<span class="langEN">Start Verify</span>
						</span>
						<span class="mainBtn verifyRunStopBtn" onclick="verifyRunStopClick()"
							style="width:300px;background:#aaa">
							<span class="langCN">å–æ¶ˆ</span>
							<span class="langEN">Cancel</span>
						</span>
						<span class="mainBtn finalizeOrderBtn" onclick="finalizeOrderClick()" style="width:300px">
							<span class="langCN">é‡è¯•</span>
							<span class="langEN">Retry</span>
						</span>
					</div>
					<div class="verifyStepState"></div>
				</div>

			</div>
		</div>






		<div class="mainBox">
			<div class="pd itemTitle">
				<span class="langCN">æ­¥éª¤å››ï¼šä¸‹è½½ä¿å­˜è¯ä¹¦PEMæ–‡ä»¶</span>
				<span class="langEN">Step 4: Download and save the certificate PEM file</span>
			</div>
			<div class="step4Hide step3Show step2Show step1Show">
				<div class="itemBox" style="color:#999">
					<span class="langCN">ç­‰å¾…ä¸­ï¼Œè¯·å…ˆå®Œæˆç¬¬ä¸‰æ­¥...</span>
					<span class="langEN">Waiting, please complete step 3 first...</span>
				</div>
			</div>
			<div class="step1Hide step2Hide step3Hide step4Show">


				<div class="itemBox">
					<div class="pd Bold">
						<i class="must">*</i>
						<span class="langCN">ä¿å­˜è¯ä¹¦PEMæ–‡ä»¶ï¼š</span>
						<span class="langEN">Save certificate PEM file: </span>
					</div>
					<div class="pd" style="font-size:13px;color:#aaa">
						<span class="langCN"><span style="color:#f80">å¿…é¡»ä¿å­˜æ­¤æ–‡ä»¶ï¼Œ</span>è¯·ç‚¹å‡»ä¸‹è½½æŒ‰é’®ä¸‹è½½ï¼Œæˆ–è€…å°†è¯ä¹¦æ–‡æœ¬å†…å®¹å¤åˆ¶ä¿å­˜ä¸º<i
								class="i downloadCertFileName"></i>æ–‡ä»¶ï¼ˆPEMçº¯æ–‡æœ¬æ ¼å¼ï¼‰ï¼›æ–‡ä»¶ååç¼€å¯æ”¹æˆ <i class="i">.crt</i> æˆ– <i
								class="i">.cer</i>ï¼Œè¿™æ ·åœ¨Windowsä¸­èƒ½ç›´æ¥åŒå‡»æ‰“å¼€æŸ¥çœ‹ã€‚æœ¬PEMæ ¼å¼æ–‡ä»¶å·²åŒ…å«ä½ çš„åŸŸåè¯ä¹¦ã€å’Œå®Œæ•´è¯ä¹¦é“¾ï¼Œæ–‡æœ¬ä¸­ç¬¬ä¸€ä¸ªCERTIFICATEä¸ºä½ çš„åŸŸåè¯ä¹¦ï¼Œåé¢çš„ä¸ºè¯ä¹¦é¢å‘æœºæ„çš„ä¸­é—´è¯ä¹¦å’Œæ ¹è¯ä¹¦ï¼Œå¦‚è¿‡æœ‰éœ€è¦ä½ å¯ä»¥è‡ªè¡Œæ‹†åˆ†æˆå¤šä¸ª.pemæ–‡ä»¶ã€‚</span>
						<span class="langEN"><span style="color:#f80">This file must be saved,</span> please click the
							download button to download, or copy the text content of the certificate and save it as <i
								class="i downloadCertFileName"></i> file (PEM plain text format); the file name suffix
							can be changed to <i class="i">.crt </i> or <i class="i">.cer </i>, so that it can be
							directly double-clicked to open and view in Windows. This PEM format file already contains
							your domain name certificate and complete certificate chain. The first CERTIFICATE in the
							text is your domain name certificate, followed by the intermediate certificate and root
							certificate of the certificate authority, if necessary, you can split it into multiple .pem
							files.</span>
					</div>
					<div class="FlexBox">
						<div class="FlexItem">
							<textarea class="txt_downloadCert" style="width:100%;height:160px" readonly></textarea>
						</div>
						<div style="padding-left:10px;line-height:30px;font-size:13px;color:#aaa">
							<div class="mainBtn" onclick="downloadBtnClick('Cert')">
								<span class="langCN">ä¸‹è½½ä¿å­˜</span>
								<span class="langEN">Download</span>
							</div>
						</div>
					</div>
				</div>


				<div class="itemBox">
					<div class="pd Bold">
						<i class="must">*</i>
						<span class="langCN">ä¿å­˜è¯ä¹¦ç§é’¥KEYæ–‡ä»¶ï¼š</span>
						<span class="langEN">Save the certificate private key KEY file: </span>
					</div>
					<div class="pd" style="font-size:13px;color:#aaa">
						<span class="langCN">è¯·ç‚¹å‡»ä¸‹è½½æŒ‰é’®ä¸‹è½½ï¼Œæˆ–è€…å°†ç§é’¥æ–‡æœ¬å†…å®¹å¤åˆ¶ä¿å­˜ä¸º<i
								class="i downloadKeyFileName"></i>æ–‡ä»¶ï¼ˆPEMçº¯æ–‡æœ¬æ ¼å¼ï¼Œ.keyåç¼€å¯è‡ªè¡Œä¿®æ”¹æˆ.pemï¼‰ã€‚å¦‚æœç¬¬äºŒæ­¥æ“ä½œä¸­ä½ æ‰‹åŠ¨å¡«å†™äº†è¯ä¹¦ç§é’¥ï¼Œæ­¤å¤„çš„è¯ä¹¦ç§é’¥å’Œä½ å¡«å†™çš„æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œå¯ä»¥ä¸éœ€è¦é‡å¤ä¿å­˜ï¼›<span
								style="color:#f80">å¦‚æœä½ æ˜¯æ–°åˆ›å»ºçš„è¯ä¹¦ç§é’¥ï¼Œåˆ™ä½ å¿…é¡»ä¸‹è½½ä¿å­˜æ­¤è¯ä¹¦ç§é’¥æ–‡ä»¶ã€‚</span></span>
						<span class="langEN">Please click the download button to download, or copy and save the text
							content of the private key as <i class="i downloadKeyFileName"></i> file (PEM plain text
							format, the .key suffix can be modified to .pem by yourself). If you manually filled in the
							certificate private key in the step 2, the certificate private key here is exactly the same
							as what you filled in, and you donâ€™t need to save it repeatedly; <span style="color:#f80">if
								you are a newly created certificate private key, you must download and save it This
								certificate private key file.</span></span>
					</div>
					<div class="FlexBox">
						<div class="FlexItem">
							<textarea class="txt_downloadKey" style="width:100%;height:80px" readonly></textarea>
						</div>
						<div style="padding-left:10px;line-height:30px;font-size:13px;color:#aaa">
							<div class="mainBtn" onclick="downloadBtnClick('Key')">
								<span class="langCN">ä¸‹è½½ä¿å­˜</span>
								<span class="langEN">Download</span>
							</div>
						</div>
					</div>
				</div>


				<div class="itemBox">
					<div class="pd Bold">
						<i class="must">*</i>
						<span class="langCN">ä¿å­˜è®°å½•LOGæ–‡ä»¶ï¼š</span>
						<span class="langEN">Save the record LOG file: </span>
					</div>
					<div class="pd" style="font-size:13px;color:#aaa">
						<span
							class="langCN">å»ºè®®ä¸‹è½½ä¿å­˜æ­¤æ–‡ä»¶ï¼Œæœ¬è®°å½•æ–‡ä»¶åŒ…å«äº†æ‰€æœ‰æ•°æ®ï¼ŒåŒ…æ‹¬ï¼šè¯ä¹¦PEMæ–‡æœ¬ã€è¯ä¹¦ç§é’¥PEMæ–‡æœ¬ã€è´¦æˆ·ç§é’¥PEMæ–‡æœ¬ã€æ‰€æœ‰é…ç½®å‚æ•°ã€‚ä¸‹æ¬¡ä½ éœ€è¦ç»­ç­¾æ–°è¯ä¹¦æ—¶ï¼Œå¯ä»¥å°†æœ¬è®°å½•æ–‡ä»¶ç›´æ¥æ‹–æ‹½è¿›æœ¬é¡µé¢ï¼Œä¼šè‡ªåŠ¨å¡«å†™æ‰€æœ‰å‚æ•°ã€‚</span>
						<span class="langEN">It is recommended to download and save this file. This record file contains
							all data, including: certificate PEM text, certificate private key PEM text, account private
							key PEM text, and all configuration parameters. Next time you need to renew a new
							certificate, you can drag and drop the record file directly into this page, and all
							parameters will be filled in automatically.</span>
					</div>
					<div class="FlexBox">
						<div class="FlexItem">
							<textarea class="txt_downloadLog" style="width:100%;height:80px" readonly></textarea>
						</div>
						<div style="padding-left:10px;line-height:30px;font-size:13px;color:#aaa">
							<div class="mainBtn" onclick="downloadBtnClick('Log')">
								<span class="langCN">ä¸‹è½½ä¿å­˜</span>
								<span class="langEN">Download</span>
							</div>
						</div>
					</div>
				</div>


			</div>
		</div>






		<div class="mainBox">

			<div class="itemBox">
				<div class="pd Bold">
					<span class="langCN">ä½ éœ€è¦å…¶ä»–æ ¼å¼çš„è¯ä¹¦æ–‡ä»¶ï¼Ÿ</span>
					<span class="langEN">Do you need certificate files in other formats?</span>
				</div>
				<div class="pd" style="font-size:13px;color:#aaa">
					<span class="langCN">å¤§éƒ¨åˆ†æœåŠ¡å™¨ç¨‹åºæ”¯æŒç›´æ¥ä½¿ç”¨ <i class="i downloadCertFileName"></i>+<i
							class="i downloadKeyFileName"></i> æ¥é…ç½®å¼€å¯HTTPSï¼ˆæ¯”å¦‚Nginxï¼‰ï¼Œå¦‚æœä½ éœ€è¦ <i class="i">*.pfx</i>ã€<i
							class="i">*.p12</i> æ ¼å¼çš„è¯ä¹¦ï¼ˆæ¯”å¦‚ç”¨äºIISï¼‰ï¼Œè¯·ç”¨ä¸‹é¢å‘½ä»¤å°†PEMè¯ä¹¦è½¬æ¢æˆ <i class="i">pfx/p12</i> æ ¼å¼ï¼š</span>
					<span class="langEN">Most server programs support directly using <i
							class="i downloadCertFileName"></i>+<i class="i downloadKeyFileName"></i> to configure and
						enable HTTPS (such as Nginx). If you need a certificate in <i class="i">*.pfx</i> or <i
							class="i">*.p12</i> format (such as for IIS), please use the following command to convert
						the PEM certificate Convert to <i class="i">pfx/p12</i> format:</span>
				</div>
				<div class="code">openssl pkcs12 -export -out <span class="downloadFileName"></span>.pfx -inkey <span
						class="downloadKeyFileName"></span> -in <span class="downloadCertFileName"></span></div>
			</div>

			<div class="itemBox">
				<div class="pd Bold">
					<span class="langCN">IISè¯ä¹¦é“¾ç¼ºå¤±ï¼Ÿ</span>
					<span class="langEN">IIS certificate chain missing?</span>
				</div>
				<div class="pd" style="font-size:13px;color:#aaa">
					<span class="langCN">å¯¹äºWindows IISæœåŠ¡å™¨ï¼Œä½ éœ€è¦å°†è¯ä¹¦é“¾å®‰è£…åˆ°â€œæœ¬åœ°è®¡ç®—æœºâ€çš„â€œä¸­é—´è¯ä¹¦é¢å‘æœºæ„â€ä¸­ï¼›è¯·å°†PEMè¯ä¹¦ä¸­çš„æ‰€æœ‰è¯ä¹¦æ‹†åˆ†æˆå•ä¸ªPEMæ–‡ä»¶ï¼ˆåç¼€æ”¹æˆ<i
							class="i">.crt</i>æˆ–<i class="i">.cer</i>ï¼‰ï¼Œç„¶åå°†ç³»ç»Ÿä¸­ç¼ºå¤±çš„ä¸­é—´è¯ä¹¦åŒå‡»æ‰“å¼€ç„¶åå®‰è£…è¿›å»ï¼›è¯¦ç»†å‚è€ƒï¼š</span>
					<span class="langEN">For Windows IIS server, you need to install the certificate chain into
						"Intermediate Certification Authorities" in "Local Computer"; please split all certificates in
						PEM certificate into a single PEM file (change the suffix to <i class="i">.crt</i> or <i
							class="i">.cer</i>), then double-click to open the missing intermediate certificate in the
						system Then install it; detailed reference:</span>
					<a href="http://support.microsoft.com/kb/954755"
						target="_blank">http://support.microsoft.com/kb/954755</a>
				</div>
			</div>

			<div class="itemBox">
				<div class="pd Bold">
					<i class="bi bi-link-45deg me-2"></i>
					<span class="langCN">ç›¸å…³é¡¹ç›®</span>
					<span class="langEN">Related Projects</span>
				</div>
				<div class="pd">
					<div class="row g-3">
						<div class="col-md-6">
							<div class="related-project-card">
								<div class="project-icon">
									<i class="bi bi-terminal"></i>
								</div>
								<div class="project-content">
									<h6 class="project-title">
										<a href="https://github.com/acmesh-official/acme.sh" target="_blank"
											class="text-decoration-none">
											acme.sh
										</a>
									</h6>
									<p class="project-description">
										<span class="langCN">çº¯Shellè„šæœ¬å®ç°çš„ACMEå®¢æˆ·ç«¯</span>
										<span class="langEN">Pure Shell script ACME client</span>
									</p>
									<div class="project-tags">
										<span class="badge bg-primary">Shell</span>
										<span class="badge bg-success">CLI</span>
									</div>
								</div>
								<div class="project-arrow">
									<a href="https://github.com/acmesh-official/acme.sh" target="_blank"><i
											class="bi bi-arrow-right"></i></a>
								</div>
							</div>
						</div>
						<div class="col-md-6">
							<div class="related-project-card">
								<div class="project-icon">
									<i class="bi bi-shield-check"></i>
								</div>
								<div class="project-content">
									<h6 class="project-title">
										<a href="https://certbot.eff.org/" target="_blank" class="text-decoration-none">
											Certbot
										</a>
									</h6>
									<p class="project-description">
										<span class="langCN">EFFå®˜æ–¹ACMEå®¢æˆ·ç«¯å·¥å…·</span>
										<span class="langEN">Official ACME client by EFF</span>
									</p>
									<div class="project-tags">
										<span class="badge bg-primary">Python</span>
										<span class="badge bg-info">Official</span>
									</div>
								</div>
								<div class="project-arrow">
									<a href="http://certbot.eff.org/" target="_blank"> <i
											class="bi bi-arrow-right"></i></a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

		</div>




		<div style="padding-top:20px;font-size:13px;color:#aaa">
			<span class="langCN">æœ¬å®¢æˆ·ç«¯åŸºäºGPL-3.0åè®®å¼€æºï¼Œä½ å¯ä»¥å…è´¹ä½¿ç”¨ã€ä¿®æ”¹å’Œåˆ†å‘æœ¬å®¢æˆ·ç«¯ï¼Œä½†éœ€è¦ä¿ç•™ç‰ˆæƒå£°æ˜å’Œå¼€æºåè®®æç¤ºã€‚</span>
			<span class="langEN">This client is open source under the GPL-3.0 protocol, you can use, modify and
				distribute this client for free, but you need to keep the copyright statement and open source protocol
				prompt.</span>

			<a href="https://pay.quickso.cn" target="_blank"
							class="pay clear"><img
								src="https://cdn.buymeacoffee.com/buttons/v2/default-blue.png"
								alt="Buy Me A Coffee"></a>
		</div>

		<div class="footer">
			<span class="langCN">Â© <span id="currentYear">2025</span> å¿«ç‚¹SSLè¯ä¹¦</span>
			<span class="langEN">Â© <span id="currentYearEN">2025</span> Quick SSL Certificate</span>
		</div>



		<div class="toastState"
			style="display:none;position:fixed;padding:10px;bottom:10px;right:10px;width:360px;max-height:120px;overflow-y:auto;background:#fff;box-shadow: 0px 0px 3px #aaa;border-radius: 10px;">
		</div>


		<!-- è¯­è¨€åˆ‡æ¢ -->
		<div class="langBtnBox position-fixed top-0 end-0 m-3">
			<div class="btn-group" role="group">
				<button type="button" class="btn btn-outline-light btn-sm langBtn langBtn_cn" onclick="LangClick('cn')">
					<i class="bi bi-translate me-1"></i>ä¸­æ–‡
				</button>
				<button type="button" class="btn btn-outline-light btn-sm langBtn langBtn_en" onclick="LangClick('en')">
					<i class="bi bi-translate me-1"></i>EN
				</button>
			</div>
		</div>

	</div>

	<!-- Bootstrap 5 JavaScript -->
	<script src="https://testingcf.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

	<!-- å›¾æ ‡å¤‡ç”¨æ–¹æ¡ˆæ£€æµ‹ -->
	<script>
		// æ£€æµ‹Bootstrap Iconsæ˜¯å¦åŠ è½½æˆåŠŸ
		function checkBootstrapIcons() {
			// åˆ›å»ºä¸€ä¸ªæµ‹è¯•å…ƒç´ 
			const testElement = document.createElement('i');
			testElement.className = 'bi bi-shield-check-fill';
			testElement.style.position = 'absolute';
			testElement.style.left = '-9999px';
			document.body.appendChild(testElement);

			// æ£€æŸ¥å­—ä½“æ˜¯å¦åŠ è½½
			const computedStyle = window.getComputedStyle(testElement);
			const fontFamily = computedStyle.getPropertyValue('font-family');

			// æ¸…ç†æµ‹è¯•å…ƒç´ 
			document.body.removeChild(testElement);

			// å¦‚æœBootstrap Iconsæ²¡æœ‰åŠ è½½ï¼Œæ˜¾ç¤ºå¤‡ç”¨å›¾æ ‡
			if (!fontFamily.includes('bootstrap-icons')) {
				document.querySelectorAll('.feature-icon').forEach(icon => {
					const biIcon = icon.querySelector('i[class*="bi-"]');
					const fallbackIcon = icon.querySelector('.fallback-icon');
					if (biIcon && fallbackIcon) {
						biIcon.style.display = 'none';
						fallbackIcon.style.display = 'inline-block';
					}
				});
			}
		}

		// é¡µé¢åŠ è½½å®Œæˆåæ£€æµ‹
		document.addEventListener('DOMContentLoaded', function () {
			// å»¶è¿Ÿæ£€æµ‹ï¼Œç¡®ä¿å­—ä½“æœ‰æ—¶é—´åŠ è½½
			setTimeout(checkBootstrapIcons, 1000);
		});
	</script>






	<script>
		//=================================================
		//================= UI functions ==================
		//=================================================
		//LICENSE: GPL-3.0, https://github.com/xiangyuecn/ACME-HTML-Web-Browser-Client
		(function () {
			"use strict";
			var ChoiceAcmeURLStoreKey = "ACME_HTML_choice_acmeURL";
			var InputDomainsStoreKey = "ACME_HTML_input_domains";
			var InputEmailStoreKey = "ACME_HTML_input_email";
			var DropConfigFile = {}; //æ‹–æ‹½è¿›æ¥çš„ä¸Šæ¬¡é…ç½®æ–‡ä»¶

			/************** UI: Initialize on Launch **************/
			window.initMainUI = function () {
				$(".eccCurveNames").html(X509.SupportECCType2Names().join(Lang("ã€", ", ")));
				$(".donateBtnIco").html(unescape("%uD83D%uDE18"));
				$(".versionBox").html(Lang("ç‰ˆæœ¬: " + Version, "Ver: " + Version));

				if (/mobile/i.test(navigator.userAgent)) {
					$(".main").prepend($(".langBtnBox").css("position", null));
					$(".donateWidget").css("position", null);
				}

				CLog("initMainUI", 0, Lang(
					`ä¸€äº›é«˜çº§é…ç½®ï¼š
- è®¾ç½® X509.DefaultType2_RSA="4096" å¯ä»¥è°ƒæ•´æ–°ç”Ÿæˆçš„RSAå¯†é’¥ä½æ•°ã€‚
- è®¾ç½® X509.DefaultType2_ECC="P-384" å¯ä»¥è°ƒæ•´æ–°ç”Ÿæˆçš„ECCå¯†é’¥æ›²çº¿ï¼ŒX509.SupportECCType2å†…ä¸ºæ”¯æŒçš„æ›²çº¿ã€‚
- è®¾ç½® DefaultDownloadFileNames å†…çš„å±æ€§å¯ä»¥ä¿®æ”¹å¯¹åº”ä¸‹è½½çš„æ–‡ä»¶é»˜è®¤åç§°ã€‚
- UIè°ƒè¯•ï¼šå®Œæˆç¬¬äºŒæ­¥åå…è®¸è¿›è¡ŒUIè°ƒè¯•ï¼Œæ‰‹åŠ¨è°ƒç”¨ Test_AllStepData_Save() ä¿å­˜æ•°æ®ï¼Œåˆ·æ–°é¡µé¢å¯æ¢å¤ç•Œé¢ã€‚`,
					`Some advanced configurations:
- Set X509.DefaultType2_RSA="4096" The number of newly generated RSA keys can be adjusted.
- Set X509.DefaultType2_ECC="P-384" The newly generated ECC key curve can be adjusted. The supported curve is in X509.SupportECCType2.
- Setting the property in DefaultDownloadFileNames can modify the default name of the corresponding downloaded file.
- UI debugging: Allow UI debugging after completing the step 2 . Manually call Test_AllStepData_Save() to save the data, and refresh the page to restore the interface.`));

				initTest_Restore();
				acmeReadDirGotoCORSInit();
				downloadFileNameShow();
				initStep1();
				initStep2();
				initStep4();
			};
			var initStep1 = function () {
				$("input[name=choice_acmeURL]").bind("click", function (e) {
					var el = e.target;
					var isManual = el.value == "manual";
					$(".in_acmeURL").css("opacity", isManual ? 1 : 0.4)
						.val(isManual ? step1ChoiceStoreVal : el.value)
						.attr("readonly", isManual ? null : "");

					var descKey = $(el).attr("desckey");
					$(".descAcmeURL").hide();
					if (descKey) $("." + descKey).show();

					step1ChoiceStoreVal = "";
					choiceAcmeURLChangeAfter();
				});
				resetStep1();
			};
			var step1ChoiceStoreVal;
			var resetStep1 = function () {
				//é€‰ä¸­ä¸Šæ¬¡é€‰æ‹©çš„è¯ä¹¦é¢å‘æœºæ„
				step1ChoiceStoreVal = DropConfigFile.acmeURL || window.Default_ACME_URL || localStorage[ChoiceAcmeURLStoreKey] || "";
				var choices = $("input[name=choice_acmeURL]")
				var idx = 0;
				if (step1ChoiceStoreVal) {
					var manualIdx = 0;
					for (var i = 0; i < choices.length; i++) {
						if (choices[i].value == step1ChoiceStoreVal) idx = i + 1;
						if (choices[i].value == "manual") manualIdx = i + 1;
					}
					if (!idx) idx = manualIdx //æ‰‹åŠ¨å¡«å†™
					idx--;
				}
				choices[idx].click();
			};
			var initStep2 = function () {
				//è¯ä¹¦ç§é’¥UI
				$(".privateKeyBox").hide();
				$("input[name=choice_privateKey]").bind("click", function (e) {
					var el = e.target;
					var isManual = el.value == "manual";
					$(".in_privateKey").css("opacity", isManual ? 1 : 0.4)
						.val("")
						.attr("readonly", isManual ? null : "");
					$(".privateKeyBox").show();

					configPrivateKeyGenerate(el.value);//ç”Ÿæˆå¯†é’¥
					configStepShow();//é‡æ–°æ˜¾ç¤ºç•Œé¢
				});

				//ACMEè´¦æˆ·ç§é’¥UI
				$(".accountKeyBox").hide();
				$("input[name=choice_accountKey]").bind("click", function (e) {
					var el = e.target;
					var isManual = el.value == "manual";
					$(".in_accountKey").css("opacity", isManual ? 1 : 0.4)
						.val("")
						.attr("readonly", isManual ? null : "");
					$(".accountKeyBox").show();

					configAccountKeyGenerate(el.value);//ç”Ÿæˆå¯†é’¥
					configStepShow();//é‡æ–°æ˜¾ç¤ºç•Œé¢
				});
			};


			//ä¸‹ä¸€æ­¥æ“ä½œæç¤º
			var NextStepTips = function () {
				return '<span style="font-size:24px;font-weight:bold;">' + Lang("è¯·è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚", " Please proceed to the next step.") + '</span>';
			};
			//è¯·ç¨å€™æç¤º
			var PleaseWaitTips = function () {
				return Lang(" è¯·ç¨å€™... ", " Please wait... ");
			};
			//è¯·é‡è¯•æç¤º
			var TryAgainTips = function () {
				return Lang(" è¯·é‡è¯•ï¼", " Please try again! ");
			};
			//æ¯ä¸€æ­¥çš„çŠ¶æ€æ›´æ–°æ˜¾ç¤º
			var ShowState = function (elem, msg, color, tag) {
				var now = new Date();
				var t = ("0" + now.getHours()).substr(-2)
					+ ":" + ("0" + now.getMinutes()).substr(-2)
					+ ":" + ("0" + now.getSeconds()).substr(-2);
				$(elem).html(msg === false ? '' : '<div style="color:' + (!color ? "" : color == 1 ? "red" : color == 2 ? "#0b1" : color == 3 ? "#fa0" : color) + '">' + (tag == null ? '[' + t + '] ' : tag) + msg + '</div>');
				return msg;
			};
			window.Toast = function (msg, color, time) {
				ShowState(".toastState", msg, color, "");

				$(".toastState").show();
				clearTimeout(Toast._int);
				Toast._int = setTimeout(function () { $(".toastState").hide(); }, time || 5000);
			};
			window.onerror = function (message, url, lineNo, columnNo, error) {
				//https://www.cnblogs.com/xianyulaodi/p/6201829.html
				Toast('ã€Uncaught Errorã€‘' + message + '<pre>' + "at:" + lineNo + ":" + columnNo + " url:" + url + "\n" + (error && error.stack || "-") + '</pre>', 1, 15000);
			};



			//ç”¨æˆ·ç‚¹å‡»æ“ä½œåŒæ­¥æ§åˆ¶ï¼Œæ–°ç‚¹å‡»æ“ä½œè¦ç»ˆæ­¢ä¹‹å‰æœªå®Œæˆçš„æ“ä½œ
			var UserClickSyncID = 0;
			var UserClickSyncKill = function (id, tag, msg) {
				if (id != UserClickSyncID) {
					var abort = Lang("è¢«ç»ˆæ­¢", "Abort", 1);
					CLog(tag + " " + abort, 3, "From: " + msg + " [" + abort + "]");
					return true;
				}
			};





			/************** UI Step1: Read ACME service directory **************/
			//è¯ä¹¦é¢å‘æœºæ„å•é€‰æŒ‰é’®ç‚¹å‡»åå¤„ç†
			var choiceAcmeURLChangeAfter = function () {
				UserClickSyncID++;

				$(".step1Hide").hide();
				$(".step1Show").show();
				ShowState(".acmeReadDirState", false);

				if ($(".in_acmeURL").val()) acmeReadDirClick();
			};
			//ç‚¹å‡»è¯»å–æœåŠ¡ç›®å½•æŒ‰é’®
			window.acmeReadDirClick = function () {
				var id = ++UserClickSyncID;

				$(".step1Hide").hide();
				$(".step1Show").show();
				var tag = "Step-1", sEl = ".acmeReadDirState";

				var url = $(".in_acmeURL").val().trim();
				if (!url) {
					ShowState(sEl, Lang("è¯·å¡«å†™æœåŠ¡URLï¼", "Please fill in the service URL!"), 1);
					return;
				}
				localStorage[ChoiceAcmeURLStoreKey] = url;
				url = ACME.URL = url.replace(/\/$/, "");

				var msg0 = CLog(tag, 0, ShowState(sEl, PleaseWaitTips() + Lang("æ­£åœ¨è¯»å–æœåŠ¡ç›®å½•ï¼Œ", "Reading service directory, ") + " URL=" + ACME.URL, 2));
				var reqDir = function () {
					ACME.Directory(function (cache, saveCache) {
						saveCacheCors = function (corsOK, err) {
							cache.corsOK = corsOK ? 1 : -1;
							cache.corsError = err || "";
							saveCache();
						};
						if (cache.corsOK == 1) dirOK();//å·²ç¼“å­˜çš„ï¼Œæ­¤ACMEæœåŠ¡æ­£å¸¸
						else if (cache.corsOK == -1) testCORSFail(cache.corsError, true);//ä¸æ­£å¸¸å·²ç¼“å­˜
						else testCORS();//æ£€æµ‹æ˜¯å¦èƒ½æ­£å¸¸è°ƒç”¨æ¥å£ï¼Œæ˜¯å¦æ”¯æŒè·¨åŸŸ
					}, function (err, status) {
						if (UserClickSyncKill(id, tag, msg0 + " err: " + err)) return;
						if (status === 0) { //å¯èƒ½æ˜¯è·¨åŸŸæ— æ³•è¯»å–åˆ°ä»»ä½•æ•°æ®
							CLog(tag, 1, ShowState(sEl, Lang("è¯»å–æœåŠ¡ç›®å½•å‡ºé”™ï¼šæ— æ³•è®¿é—®æ­¤URLã€‚", "Read service directory error: This URL cannot be accessed.") + TryAgainTips(), 1));

							acmeReadDirGotoCORS(Lang("å¦‚æœä½ å¯ä»¥åœ¨æµè§ˆå™¨ä¸­ç›´æ¥æ‰“å¼€å¹¶è®¿é—®æ­¤ACMEæœåŠ¡URLï¼Œä»£è¡¨æ­¤ACMEæœåŠ¡å¯¹è·¨åŸŸè®¿é—®æ”¯æŒä¸è‰¯ï¼Œåˆ™è¯·æŒ‰ä¸‹é¢æ­¥éª¤æ“ä½œï¼š", "If you can open and access this ACME service URL directly in your browser, it represents that this ACME service has poor support for cross-domain access, please follow the steps below:"));
						} else {
							CLog(tag, 1, ShowState(sEl, Lang("è¯»å–æœåŠ¡ç›®å½•å‡ºé”™ï¼š" + err, "Read service directory error: " + err) + TryAgainTips(), 1));
						};
					});
				};
				var saveCacheCors;
				var dirOK = function () {
					if (UserClickSyncKill(id, tag, msg0)) return;
					configStepShow();
					CLog(tag, 0, ShowState(sEl, Lang("è¯»å–æœåŠ¡ç›®å½•æˆåŠŸï¼Œ", "Read service directory OK,")
						+ NextStepTips() + " URL=" + ACME.URL, 2), ACME.DirData);
				};

				//ZeroSSLæ¥å£è·¨åŸŸæ”¯æŒå¤ªå·®ï¼Œå‘ç°è¿™ç§å°±ç›´æ¥åœ¨ä»–ä»¬ç½‘ç«™é‡Œé¢è·‘
				var testCORS = function () {
					if (UserClickSyncKill(id, tag, msg0)) return;
					msg0 = CLog(tag, 0, ShowState(sEl, PleaseWaitTips() + Lang("æ­£åœ¨æµ‹è¯•æ­¤ACMEæœåŠ¡å¯¹æµè§ˆå™¨çš„æ”¯æŒæƒ…å†µï¼Œ", "Testing browser support for this ACME service, ") + " URL=" + ACME.URL, 2));
					ACME.GetNonce(true, function () {
						ACME.TestAccountCORS(function () {
							CLog(tag, 0, Lang("æ­¤ACMEæœåŠ¡å¯¹æµè§ˆå™¨çš„æ”¯æŒè‰¯å¥½ã€‚", "This ACME service has good browser support."));
							saveCacheCors(true);
							dirOK();
						}, testCORSFail);
					}, function (err, corsFail) { //GetNonce èƒ½æ˜ç¡®æ£€æµ‹åˆ°æ˜¯å¦æ”¯æŒè·¨åŸŸå¯ä»¥ç¼“å­˜èµ·æ¥ï¼Œè´¦æˆ·åœ°å€å¯èƒ½æ˜¯ç½‘ç»œé”™è¯¯ä¸ç¼“å­˜
						if (corsFail) saveCacheCors(false, err);
						testCORSFail(err, corsFail);
					});
				};
				var testCORSFail = function (err, corsFail) {
					if (UserClickSyncKill(id, tag, msg0 + " err: " + err)) return;
					CLog(tag, 1, ShowState(sEl, Lang(
						"æµ‹è¯•æ­¤ACMEæœåŠ¡å¯¹æµè§ˆå™¨çš„æ”¯æŒæƒ…å†µï¼Œå‘ç”Ÿé”™è¯¯ï¼š" + err
						, "Test browser support for this ACME service, An error occurred: " + err)
						+ (corsFail ? "" : TryAgainTips()), 1));
					LangReview(sEl);//err from cache
					if (corsFail) acmeReadDirGotoCORS();
				};

				reqDir();
			};






			/************** UI Step2: Certificate Configuration **************/
			//æ˜¾ç¤ºç¬¬äºŒæ­¥ç•Œé¢
			var configStepShow = function () {
				$(".step2Hide").hide();
				$(".step2Show").show();
				ShowState(".configStepState", false);

				$(".eabShow")[ACME.StepData.needEAB ? 'show' : 'hide']();
				if (DropConfigFile.eabKid) $(".in_eab_kid").val(DropConfigFile.eabKid);
				if (DropConfigFile.eabKey) $(".in_eab_key").val(DropConfigFile.eabKey);

				$(".termsAgreeBox")[ACME.StepData.termsURL ? 'show' : 'hide']();
				$(".termsAgreeTips").html(Lang('æˆ‘åŒæ„æ­¤è¯ä¹¦é¢å‘æœºæ„ACMEæœåŠ¡çš„<a href="' + ACME.StepData.termsURL + '" target="_blank">æœåŠ¡æ¡æ¬¾</a>ã€‚', 'I agree to the <a href="' + ACME.StepData.termsURL + '" target="_blank">terms of service</a> for this Certificate Authority ACME Service.'));
				$(".choice_termsAgree").prop("checked", true);

				var el = $(".in_domains");//å¡«å……ä¸Šæ¬¡å¡«å†™çš„åŸŸååˆ—è¡¨
				var valS = localStorage[InputDomainsStoreKey];
				var val = DropConfigFile.domains && DropConfigFile.domains.join(", ") || valS;
				if (!el.val()) {
					el.val(val || "");
				}
				$(".choice_domains_store").prop("checked", !!valS);

				var el = $(".in_email");//å¡«å……ä¸Šæ¬¡å¡«å†™çš„è”ç³»é‚®ç®±
				var valS = localStorage[InputEmailStoreKey];
				var val = DropConfigFile.email || valS;
				if (!el.val()) {
					el.val(val || "");
				}
				$(".choice_email_store").prop("checked", !!valS);

				var setKey = function (k) {
					if (DropConfigFile[k]) {
						$("input[name=choice_" + k + "][value=manual]")[0].click();
						$(".in_" + k).val(DropConfigFile[k]);
					}
				};
				setKey("privateKey"); setKey("accountKey");

				DropConfigFile = {};//é…ç½®å®Œæˆï¼Œä¸¢å¼ƒæ‹–æ‹½è¿›æ¥çš„é…ç½®ä¿¡æ¯
			};
			//ç”Ÿæˆè¯ä¹¦çš„å¯†é’¥å¯¹
			var configPrivateKeyGenerate = function (type) {
				var id = ++UserClickSyncID;
				var tag = "Step-2", sEl = ".privateKeyState";

				var keyTag = "", type2;
				if (type == "generateRSA") {
					type = "RSA"; type2 = X509.DefaultType2_RSA;
					keyTag = Lang("è¯ä¹¦RSAç§é’¥(" + type2 + "ä½)", "Certificate RSA private key (" + type2 + " bits)");
				} else if (type == "generateECC") {
					type = "ECC"; type2 = X509.DefaultType2_ECC; var type2N = X509.SupportECCType2[type2] || type2;
					keyTag = Lang("è¯ä¹¦ECCç§é’¥(" + type2N + "æ›²çº¿)", "Certificate ECC Private Key (" + type2N + " curve)");
				} else {
					ShowState(sEl, false);
					return;
				};

				var msg0 = CLog(tag, 0, ShowState(sEl, PleaseWaitTips() + Lang("æ­£åœ¨åˆ›å»º", "Generating ") + keyTag, 2));
				X509.KeyGenerate(type, type2, function (pem) {
					if (UserClickSyncKill(id, tag, msg0)) return;
					$(".in_privateKey").val(pem);
					CLog(tag, 0, ShowState(sEl, keyTag + Lang("ï¼Œåˆ›å»ºæˆåŠŸã€‚", ", generated successfully."), 2), '\n' + pem);
				}, function (err) {
					if (UserClickSyncKill(id, tag, msg0 + " err: " + err)) return;
					CLog(tag, 1, ShowState(sEl, keyTag + Lang("ï¼Œå‘ç”Ÿé”™è¯¯ï¼š" + err, ", An error occurred: " + err), 1));
				});
			};
			//ç”ŸæˆACMEè´¦æˆ·çš„å¯†é’¥å¯¹
			var configAccountKeyGenerate = function (type) {
				var id = ++UserClickSyncID;
				var tag = "Step-2", sEl = ".accountKeyState";

				var keyTag = "", type2;
				if (type == "generateRSA") {
					type = "RSA"; type2 = X509.DefaultType2_RSA;
					keyTag = Lang("ACMEè´¦æˆ·RSAç§é’¥(" + type2 + "ä½)", "ACME account RSA private key (" + type2 + " bits)");
				} else if (type == "generateECC") {
					type = "ECC"; type2 = X509.DefaultType2_ECC; var type2N = X509.SupportECCType2[type2] || type2;
					keyTag = Lang("ACMEè´¦æˆ·ECCç§é’¥(" + type2N + "æ›²çº¿)", "ACME account ECC Private Key (" + type2N + " curve)");
				} else {
					ShowState(sEl, false);
					return;
				};

				var msg0 = CLog(tag, 0, ShowState(sEl, PleaseWaitTips() + Lang("æ­£åœ¨åˆ›å»º", "Generating ") + keyTag, 2));
				X509.KeyGenerate(type, type2, function (pem) {
					if (UserClickSyncKill(id, tag, msg0)) return;
					$(".in_accountKey").val(pem);
					CLog(tag, 0, ShowState(sEl, keyTag + Lang("ï¼Œåˆ›å»ºæˆåŠŸã€‚", ", generated successfully."), 2), '\n' + pem);
				}, function (err) {
					if (UserClickSyncKill(id, tag, msg0 + " err: " + err)) return;
					CLog(tag, 1, ShowState(sEl, keyTag + Lang("ï¼Œå‘ç”Ÿé”™è¯¯ï¼š" + err, ", An error occurred: " + err), 1));
				});
			};
			//ç‚¹å‡»ç¡®å®šæŒ‰é’®ï¼Œå®Œæˆé…ç½®åŸŸåå’Œç§é’¥çš„é…ç½®
			window.configStepClick = function () {
				var id = ++UserClickSyncID;
				var tag = "Step-2", sEl = ".configStepState";

				$(".step2Hide").hide();
				$(".step2Show").show();
				ShowState(sEl, false);

				var domains = $(".in_domains").val().trim();
				var domainsStore = $(".choice_domains_store").prop("checked");
				var privateKey = $(".in_privateKey").val().trim();
				var accountKey = $(".in_accountKey").val().trim();
				var email = $(".in_email").val().trim();
				var emailStore = $(".choice_email_store").prop("checked");
				var eabKid = $(".in_eab_kid").val().trim();
				var eabKey = $(".in_eab_key").val().trim();
				var termsAgree = $(".choice_termsAgree").prop("checked");

				//åŸŸåè½¬æˆæ•°ç»„
				domains = domains.replace(/\s+/g, ",").replace(/ï¼Œ+/g, ",").split(/,+/);
				for (var i = 0, mp = {}; i < domains.length; i++) {
					var domain = domains[i];
					if (!domain) {
						domains.splice(i, 1); i--; continue;
					} else if (mp[domain])
						return ShowState(sEl, Lang("åŸŸå" + domain + "é‡å¤ï¼", "Duplicate domain name " + domain + "!"), 1);
					if (/[:\/;]/.test(domain))//ç®€å•æ ¡éªŒåŸŸåæ ¼å¼
						return ShowState(sEl, Lang("åŸŸå" + domain + "æ ¼å¼é”™è¯¯ï¼", "Format error of domain name " + domain + "!"), 1);
					mp[domain] = 1;
				}
				localStorage[InputDomainsStoreKey] = domainsStore ? domains.join(", ") : "";
				localStorage[InputEmailStoreKey] = emailStore ? email : "";

				//æ ¡éªŒæ˜¯å¦è¾“å…¥
				if (!domains.length)
					return ShowState(sEl, Lang("è¯·å¡«å†™è¯ä¹¦ä¸­è¦åŒ…å«çš„åŸŸåï¼", "Please fill in domain name to be included in the certificate!"), 1);
				if (!privateKey)
					return ShowState(sEl, Lang("è¯·é€‰æ‹©è¯ä¹¦çš„ç§é’¥ï¼", "Please select the private key of the certificate!"), 1);
				if (!accountKey)
					return ShowState(sEl, Lang("è¯·é€‰æ‹©ACMEè´¦æˆ·çš„ç§é’¥ï¼", "Please select the private key of ACME account!"), 1);
				if (!/.+@.+\..+/.test(email) || /[\s,;]/.test(email))
					return ShowState(sEl, Lang("è¯·æ­£ç¡®å¡«å†™è”ç³»é‚®ç®±ï¼", "Please fill in the contact email correctly!"), 1);
				if (ACME.StepData.needEAB && !(eabKid && eabKey))
					return ShowState(sEl, Lang("è¯·å¡«å†™EAB KIDå’ŒHMAC KEYï¼", "Please fill in EAB KID and HMAC KEY!"), 1);
				if (ACME.StepData.termsURL && !termsAgree)
					return ShowState(sEl, Lang("æœªåŒæ„æ­¤ACMEæœåŠ¡çš„æœåŠ¡æ¡æ¬¾ï¼", "Do not agree to the terms of service of this acme service!"), 1);

				//æ ¡éªŒç§é’¥æ ¼å¼æ˜¯å¦æ”¯æŒ
				var privateKeyInfo, parsePrivateKey = function () {
					X509.KeyParse(privateKey, function (info) {
						privateKeyInfo = info; parseAccountKey();
					}, function (err) {
						ShowState(sEl, Lang("è¯ä¹¦çš„ç§é’¥æ— æ•ˆï¼š", "The private key of the certificate is invalid: ") + err, 1);
					}, 1);
				};
				var accountKeyInfo, parseAccountKey = function () {
					X509.KeyParse(accountKey, function (info) {
						accountKeyInfo = info; parseKeyOK();
					}, function (err) {
						ShowState(sEl, Lang("ACMEè´¦æˆ·çš„ç§é’¥æ— æ•ˆï¼š", "The private key of the ACME account is invalid: ") + err, 1);
					}, 1);
				};

				var msg0 = CLog(tag, 0, ShowState(sEl, PleaseWaitTips(), 2));
				//è®¾ç½®é…ç½®æ•°æ®
				var parseKeyOK = function () {
					if (UserClickSyncKill(id, tag, msg0)) return;

					ACME.StepData.config = {
						domains: domains
						, privateKey: privateKeyInfo
						, accountKey: accountKeyInfo
						, email: email
						, eabKid: eabKid
						, eabKey: eabKey
					};
					CLog(tag, 0, "config", ACME.StepData.config);

					acmeNewAccount();
				};

				//ACMEè´¦æˆ·æ¥å£è°ƒç”¨
				var acmeNewAccount = function () {
					var msg0 = CLog(tag, 0, ShowState(sEl, PleaseWaitTips() + Lang("æ­£åœ¨è°ƒç”¨ACMEæœåŠ¡çš„newAccountæ¥å£ï¼š", "The newAccount interface that is calling the ACME service: ") + ACME.DirData.newAccount, 2));
					ACME.StepAccount(function () {
						if (UserClickSyncKill(id, tag, msg0)) return;
						acmeNewOrder();
					}, function (err) {
						if (UserClickSyncKill(id, tag, msg0 + " err: " + err)) return;
						CLog(tag, 1, ShowState(sEl, Lang("è°ƒç”¨ACMEæœåŠ¡çš„newAccountæ¥å£ï¼š", "Call the newAccount interface of the ACME service: ")
							+ ACME.DirData.newAccount + Lang("ï¼Œå‘ç”Ÿé”™è¯¯ï¼š" + err, ", An error occurred: " + err), 1));
					});
				};
				//ACMEè®¢å•åˆ›å»ºæ¥å£è°ƒç”¨
				var acmeNewOrder = function () {
					var msg0, onProgress = function (tips) {
						if (id != UserClickSyncID) return;
						msg0 = CLog(tag, 0, ShowState(sEl, PleaseWaitTips() + Lang("æ­£åœ¨è°ƒç”¨ACMEæœåŠ¡çš„è®¢å•æ¥å£ã€‚", "The order interface that is calling the ACME service.") + ' ' + tips + " URL:" + ACME.DirData.newOrder, 2));
					}; onProgress("");
					ACME.StepOrder(onProgress, function () {
						if (UserClickSyncKill(id, tag, msg0)) return;
						acmeOK();
					}, function (err) {
						if (UserClickSyncKill(id, tag, msg0 + " err: " + err)) return;
						CLog(tag, 1, ShowState(sEl, Lang("è°ƒç”¨ACMEæœåŠ¡çš„è®¢å•æ¥å£ï¼š", "Call the order interface of the ACME service: ")
							+ ACME.DirData.newOrder + Lang("ï¼Œå‘ç”Ÿé”™è¯¯ï¼š" + err, ", An error occurred: " + err), 1));
					});
				};
				//ACMEæ¥å£è°ƒç”¨å®Œæˆï¼Œæ˜¾ç¤ºä¸‹ä¸€æ­¥
				var acmeOK = function () {
					verifyStepShow();

					CLog(tag, 0, ShowState(sEl, Lang(
						"é…ç½®å®Œæˆï¼Œ"
						, "Configuration is complete, ")
						+ NextStepTips(), 2), ACME.StepData);
				};

				parsePrivateKey();
			};






			/************** UI Step3: Verify Domain Ownership **************/
			//æ˜¾ç¤ºç¬¬ä¸‰æ­¥ç•Œé¢
			var verifyStepShow = function () {
				$(".step3Hide").hide();
				$(".step3Show").show();
				$(".verifyStepBtn").show();
				$(".verifyRunStopBtn").hide();
				$(".finalizeOrderBtn").hide();
				ShowState(".verifyStepState", false);

				//æ˜¾ç¤ºæ‰€æœ‰åŸŸåçš„éªŒè¯ç•Œé¢
				verifyBoxShow();
			};
			//åœæ­¢éªŒè¯
			window.verifyRunStopClick = function () {
				var id = ++UserClickSyncID;
				$(".verifyStepBtn").show();
				$(".verifyRunStopBtn").hide();
				$(".finalizeOrderBtn").hide();
				ShowState(".verifyStepState", false);
				verifyRunStopFn && verifyRunStopFn();
			};
			var verifyRunStopFn;
			//ç‚¹å‡»å¼€å§‹éªŒè¯æŒ‰é’®ï¼ŒéªŒè¯æ‰€æœ‰åŸŸåæ‰€æœ‰æƒ
			window.verifyStepClick = function () {
				var id = ++UserClickSyncID;
				var tag = "Step-3", sEl = ".verifyStepState";

				$(".step3Hide").hide();
				$(".step3Show").show();
				$(".verifyStepBtn").hide();
				$(".verifyRunStopBtn").show();
				$(".finalizeOrderBtn").hide();
				ShowState(sEl, false);

				var domains = ACME.StepData.config.domains, auths = ACME.StepData.auths;
				//éªŒè¯ä¸­æ›´æ–°çŠ¶æ€æ˜¾ç¤º
				var updateState = function (init, stopNow, isFail) {
					var isStop = stopNow || id != UserClickSyncID;
					var okCount = 0, errCount = 0, execCount = 0;
					for (var i0 = 0; i0 < domains.length; i0++) {
						var domain = domains[i0], auth = auths[domain], challs = auth.challenges;
						var stateEl = $(".verifyItemState_" + i0);
						//authState: 0 å¾…éªŒè¯ï¼Œ1éªŒè¯ä¸­ï¼Œ2ç­‰å¾…é‡è¯•authTryCountï¼Œ11éªŒè¯æˆåŠŸï¼Œ12éªŒè¯å¤±è´¥authError
						if (auth.authState == 11) {//éªŒè¯æˆåŠŸçš„ï¼Œåˆå§‹åŒ–ä¹Ÿä¸è¦ä¿®æ”¹éªŒè¯æ–¹å¼äº†
							ShowState(stateEl, ACME.ChallName(challs[auth.challIdx]) + " OK!", 2, "");
							okCount++;
							continue;
						}
						if (init) { //è®°ä½é€‰ä¸­çš„éªŒè¯ç±»å‹
							var choiceEl = $("input[name=choice_authItem_" + i0 + "]");
							for (var i = 0; i < choiceEl.length; i++) {
								var el = choiceEl[i];
								if (!el.checked) { //æœªé€‰ä¸­çš„éšè—æ‰
									$(el.parentNode).hide();
								} else {
									auth.challIdx = +$(el).attr("challidx");
								}
							}
							auth.authState = 0;
							auth.authTryCount = 0;
							auth.authError = "";
							auth.authTimer = 0;
						}
						var challName = ACME.ChallName(challs[auth.challIdx]);
						if (auth.authState == 12) {//éªŒè¯å¤±è´¥
							ShowState(stateEl, challName + Lang("ï¼ŒéªŒè¯å¤±è´¥ï¼š", ", Verify failed: ")
								+ auth.authError, 1, "");
							errCount++;
							continue;
						}
						execCount++;
						if (isStop) {
							ShowState(stateEl, false);
							clearTimeout(auth.authTimer); auth.authTimer = 0;
						} else if (auth.authState == 2)
							ShowState(stateEl, Lang("ç­‰å¾…é‡è¯•ä¸­...", "Waiting for retry...")
								+ " " + auth.authTryCount + " " + auth.authError, 3, "");
						else if (auth.authState == 1)
							ShowState(stateEl, Lang("éªŒè¯ä¸­...", "Verify in progress..."), 0, "");
						else ShowState(stateEl, Lang("ç­‰å¾…éªŒè¯...", "Waiting for verify..."), 0, "");
					}
					if (!isStop || stopNow) {
						var goto2 = Lang("è¯·è¿”å›ç¬¬äºŒæ­¥é‡æ–°å¼€å§‹æ“ä½œï¼", "Please go back to step 2 and start over! ");
						var msg = ShowState(sEl, (isFail ? Lang("éªŒè¯å¤±è´¥ï¼Œ", "Verify failed, ") + goto2 :
							isStop ? Lang("å·²å–æ¶ˆï¼Œ", "Canceled, ") + goto2 :
								Lang("æ­£åœ¨éªŒè¯ï¼Œè¯·è€å¿ƒç­‰å¾…... ", "Verifying, please wait... "))
							+ "<div>"
							+ Lang("éªŒè¯é€šè¿‡ï¼š", "Verify pass: ") + okCount + ", "
							+ Lang("æœªé€šè¿‡ï¼š", "Failed: ") + errCount + ", "
							+ Lang("éªŒè¯ä¸­ï¼š", "Verify in progress: ") + execCount
							+ "</div>"
							, isStop ? 1 : 0);
						if (isStop) {
							CLog(tag, 1, msg);
						}
					}
				}
				updateState(1);
				//å–ä¸€ä¸ªè¿›è¡ŒéªŒè¯
				var run = function () {
					if (id != UserClickSyncID) return;
					updateState();
					var authItem, hasRunning = 0, okCount = 0, errCount = 0;
					for (var i0 = 0; i0 < domains.length; i0++) {
						var domain = domains[i0], auth = auths[domain];
						if (!authItem && !auth.authState) authItem = auth;
						if (auth.authState == 1) hasRunning++;
						if (auth.authState == 11) okCount++;
						if (auth.authState == 12) errCount++;
					}
					if (okCount == domains.length)//å…¨éƒ¨éªŒè¯æˆåŠŸ
						return verifyOK();
					if (okCount + errCount == domains.length)//å…¨éƒ¨éªŒè¯å®Œæˆï¼Œå­˜åœ¨ä¸é€šè¿‡çš„
						return verifyFail();
					if (!authItem || hasRunning) return;//æ²¡æœ‰å¾…éªŒè¯çš„æˆ–å·²æœ‰éªŒè¯ä¸­ï¼Œç»§ç»­ç­‰å¾…

					authItem.authState = 1;
					authItem.authTryCount++;
					authItem.authError = "";
					updateState();
					ACME.StepVerifyAuthItem(authItem, authItem.challIdx, function (isOk, retryTime, err) {
						if (id != UserClickSyncID) return;
						if (isOk) {
							authItem.authState = 11;
						} else {
							authItem.authState = 2;
							authItem.authError = err;
							authItem.authTimer = setTimeout(function () {
								authItem.authState = 0;
								authItem.authTimer = 0;
								run();
							}, retryTime);
						}
						run();
					}, function (err) {
						if (id != UserClickSyncID) return;
						authItem.authState = 12;
						authItem.authError = err;
						run();
					});
				};

				CLog(tag, 0, "==========Verify Start==========");
				var verifyEnd = function () {
					$(".verifyRunStopBtn").hide();
					verifyRunStopFn = null;
					CLog(tag, 0, "==========Verify End==========");
				};
				//ä¸­é€”åœæ­¢æ§åˆ¶
				verifyRunStopFn = function () {
					verifyEnd();
					updateState(0, 1);
				};
				//éªŒè¯å®Œæˆï¼Œå­˜åœ¨ä¸é€šè¿‡çš„
				var verifyFail = function () {
					CLog(tag, 1, "Verify Fail!");
					updateState(0, 1, 1);
					verifyEnd();
				};
				//å…¨éƒ¨éªŒè¯æˆåŠŸ
				var verifyOK = function () {
					CLog(tag, 0, "Verify OK!");
					verifyEnd();

					finalizeOrderClick();
				};

				//è°ƒç”¨å®Œæˆè®¢å•æ¥å£ï¼Œç”Ÿæˆè¯ä¹¦
				window.finalizeOrderClick = function () {
					$(".finalizeOrderBtn").hide();
					var msg0, onProgress = function (tips) {
						if (id != UserClickSyncID) return;
						msg0 = CLog(tag, 0, ShowState(sEl, PleaseWaitTips()
							+ Lang("éªŒè¯å·²é€šè¿‡ï¼Œæ­£åœ¨ç­¾å‘è¯ä¹¦ã€‚", "Verify passed, issuing certificate.")
							+ ' ' + tips, 2));
					}; onProgress("");
					ACME.StepFinalizeOrder(onProgress, function () {
						if (UserClickSyncKill(id, tag, msg0)) return;
						//æ˜¾ç¤ºä¸‹ä¸€æ­¥
						downloadStepShow();

						CLog(tag, 0, ShowState(sEl, Lang(
							"éªŒè¯å·²é€šè¿‡ï¼Œè¯ä¹¦å·²ç­¾å‘ï¼Œ"
							, "Verification passed, The certificate has been issued, ")
							+ NextStepTips(), 2), ACME.StepData);
					}, function (err) {
						if (UserClickSyncKill(id, tag, msg0 + " err: " + err)) return;
						$(".finalizeOrderBtn").show();
						CLog(tag, 1, ShowState(sEl, Lang("ç­¾å‘è¯ä¹¦å‘ç”Ÿé”™è¯¯ï¼Œ", "Error issuing certificate, ") + TryAgainTips()
							+ Lang("å¦‚æœå¤šæ¬¡é‡è¯•éƒ½æ— æ³•ç­¾å‘è¯ä¹¦ï¼Œå¯èƒ½éœ€è¦è¿”å›ç¬¬äºŒæ­¥é‡æ–°å¼€å§‹æ“ä½œã€‚", "If the certificate cannot be issued after multiple retries, you may need to return to step 2 to restart the operation.")
							+ " Error: " + err, 1));
					});
				};

				run();
			};







			/************** UI Step4: Download and save the certificate PEM file **************/
			//æ˜¾ç¤ºç¬¬å››æ­¥ç•Œé¢
			var downloadStepShow = function () {
				$(".step4Hide").hide();
				$(".step4Show").show();
				ShowState(".downloadStepState", false);

				var config = ACME.StepData.config;
				var hasPEM = ACME.StepData.order.downloadPEM;
				var pemTxt = hasPEM || Lang("æœªå‘ç°è¯ä¹¦ï¼Œè¯·åˆ°ç¬¬äºŒæ­¥é‡æ–°æ“ä½œï¼", "No certificate found, please go to the step 2 to operate again!", true);

				$(".txt_downloadCert").val(pemTxt);
				$(".txt_downloadKey").val(config.privateKey.pem);

				downFileName = config.domains[0].replace(/^\*\./g, "").replace(/[^\w]/g, "_");
				downloadFileNameShow(downFileName);

				var logTxts = [];
				var SP = function (tag) {
					logTxts.push("\n=========== " + tag + " ===========");
					return logTxts
				}
				var logSet = Object.assign({
					acmeURL: ACME.URL
					, accountURL: ACME.StepData.account.url
					, X509: {
						DefaultType2_RSA: X509.DefaultType2_RSA
						, DefaultType2_ECC: X509.DefaultType2_ECC
					}
					, Window: {
						DefaultDownloadFileNames: DefaultDownloadFileNames
					}
				}, config);
				logSet.privateKey = config.privateKey.pem;
				logSet.accountKey = config.accountKey.pem;

				var logTitle = '/********** ' + Lang($(".clientNameCN").html(), $(".clientNameEN").html(), true) + ' *********/';
				logTxts.push(logTitle);
				logTxts.push(Lang("åœ¨çº¿ç½‘å€ï¼š", "Online website: ", true) + 'https://ssl.quickso.cn');
				logTxts.push("");
				logTxts.push('GitHub: https://github.com/muzihuaner/ACME-HTML-Web-Browser-Client');
				logTxts.push("");
				logTxts.push(Lang("æç¤ºï¼šä½ å¯ä»¥å°†æœ¬æ–‡ä»¶æ‹–æ‹½è¿›å®¢æˆ·ç«¯ç½‘é¡µå†…ï¼Œå°†è‡ªåŠ¨å¡«å……æœ¬æ¬¡è¯ä¹¦ç”³è¯·çš„æ‰€æœ‰é…ç½®å‚æ•°ã€‚", "Tip: You can drag and drop this file into the client web page, and all configuration parameters of this certificate application will be filled automatically.", true));
				logTxts.push("");
				SP(Lang("è¯ä¹¦ç”³è¯·æ—¶é—´", "Certificate Application Time", true))
					.push(new Date().toLocaleString());
				SP(Lang("åŸŸååˆ—è¡¨", "Domain Name List", true))
					.push(config.domains.join(", "));
				SP(Lang("ACMEæœåŠ¡åœ°å€", "ACME Service URL", true))
					.push(ACME.URL);
				SP(Lang("CSRæ–‡æœ¬", "CSR Text", true))
					.push(ACME.StepData.order.orderCSR);
				SP(Lang("è¯ä¹¦PEMæ–‡æœ¬", "Certificate PEM Text", true))
					.push(pemTxt);
				SP(Lang("è¯ä¹¦ç§é’¥PEMæ–‡æœ¬", "Certificate Private Key PEM Text", true))
					.push(config.privateKey.pem);
				SP(Lang("è´¦æˆ·ç§é’¥PEMæ–‡æœ¬", "Account Private Key PEM Text", true))
					.push(config.accountKey.pem);
				SP(Lang("è´¦æˆ·URL", "Account URL", true))
					.push(ACME.StepData.account.url);
				SP(Lang("å®Œæ•´é…ç½®ä¿¡æ¯", "Complete Configuration Information", true))
					.push("<ACME-HTML-Web-Browser-Client>" + JSON.stringify(logSet) + "</ACME-HTML-Web-Browser-Client>");
				logTxts.push(""); logTxts.push(logTitle); logTxts.push("");

				$(".txt_downloadLog").val(hasPEM ? logTxts.join("\n") : pemTxt);
			};
			var initStep4 = function () {//é¡µé¢å¯åŠ¨æ—¶åˆå§‹åŒ–ï¼Œç»‘å®šé…ç½®æ–‡ä»¶æ‹–æ‹½äº‹ä»¶
				$("body").bind("dragover", function (e) {
					e.preventDefault();
				}).bind("drop", function (e) {
					e.preventDefault();

					var file = e.dataTransfer.files[0];
					if (!file) return;
					var reader = new FileReader();
					reader.onload = function (e) {
						var txt = reader.result;
						var m = /ACME-HTML-Web-Browser-Client>(.+?)<\/ACME-HTML-Web-Browser-Client/.exec(txt);
						if (!m) return Toast(Lang("æ‹–å…¥çš„æ–‡ä»¶ä¸­æœªå‘ç°é…ç½®ä¿¡æ¯ï¼Œè¯·æ‹–ä¸Šæ¬¡ç”³è¯·è¯ä¹¦æ—¶ä¿å­˜çš„è®°å½•LOGæ–‡ä»¶ï¼", "No configuration information is found in the dragged file. Please drag the LOG file saved in the last certificate application!"), 1);

						DropConfigFile = JSON.parse(m[1]);
						for (var k in DropConfigFile.X509) X509[k] = DropConfigFile.X509[k];
						for (var k in DropConfigFile.Window) window[k] = DropConfigFile.Window[k];

						CLog("DropConfigFile", 0, "Reset Config", DropConfigFile);
						Toast(Lang("è¯†åˆ«åˆ°æ‹–å…¥çš„è®°å½•LOGæ–‡ä»¶ï¼Œå·²å¡«å……ä¸Šæ¬¡ç”³è¯·è¯ä¹¦æ—¶ä½¿ç”¨çš„é…ç½®ã€‚", "The LOG file of the dragged record is identified, and the configuration used in the last certificate application has been filled."), 2);
						resetStep1();//é‡æ–°åˆå§‹åŒ–ç¬¬1æ­¥
						downloadFileNameShow();
					}
					reader.readAsText(file);
				});
			};
			var downFileName = "";
			window.DefaultDownloadFileNames = { //å…è®¸è®¾ç½®é»˜è®¤çš„æ–‡ä»¶åï¼Œä¸‹è½½æ—¶è‡ªåŠ¨ä½¿ç”¨æ­¤æ–‡ä»¶å
				Cert: "" /*domain.crt*/, Key: "" /*domain.key*/, Log: "" /*domain.log*/
			};
			window.downloadBtnClick = function (type) {
				var val = $(".txt_download" + type).val();
				var fileName = downFileName;
				if (type == "Cert") fileName += ".pem";
				if (type == "Key") fileName += ".key";
				if (type == "Log") fileName += ".log";
				fileName = DefaultDownloadFileNames[type] || fileName;

				var url = URL.createObjectURL(new Blob([val], { "type": "text/plain" }));
				var downA = document.createElement("A");
				downA.href = url;
				downA.download = fileName;
				downA.click();
			};
			window.downloadFileNameShow = function (name) {//æ˜¾ç¤ºä¸‹è½½æ–‡ä»¶åç§°ï¼Œä¼˜å…ˆä½¿ç”¨æ‰‹åŠ¨è®¾ç½®çš„é»˜è®¤åç§°
				name = name || "your_domain";
				var name2 = (DefaultDownloadFileNames.Cert || "").replace(/\.[^\.]+$/g, "");
				$(".downloadFileName").html(name2 || name);
				$(".downloadKeyFileName").html(DefaultDownloadFileNames.Key || name + ".key");
				$(".downloadCertFileName").html(DefaultDownloadFileNames.Cert || name + ".pem");
			};













			//Test_æ‰“å¤´çš„æ–¹æ³•ä»…ä¾›æµ‹è¯•ç”¨ï¼šå®Œæˆç¬¬äºŒæ­¥åå…è®¸è¿›è¡ŒUIè°ƒè¯•ï¼Œæ‰‹åŠ¨è°ƒç”¨Test_AllStepData_Save()ï¼Œåˆ·æ–°é¡µé¢å¯æ¢å¤ç•Œé¢
			window.Test_AllStepData_Save = function () {
				if (!ACME.StepData.order) throw new Error(Lang("æœªå®Œæˆç¬¬äºŒæ­¥æ“ä½œ", "The step 2 is not completed", true));

				var config = ACME.StepData.config;
				delete ACME.PrevNonce;
				config.privateKey = config.privateKey.pem;
				config.accountKey = config.accountKey.pem;

				localStorage[Test_AllStepData_StoreKey] = JSON.stringify(ACME);
				ACME = null;
				console.warn(Lang("ä»…ä¾›æµ‹è¯•ï¼šå·²ä¿å­˜æµ‹è¯•æ•°æ®ï¼Œéœ€åˆ·æ–°é¡µé¢", "For testing only: the test data has been saved, and the page needs to be refreshed", true));
			};
			var Test_AllStepData_StoreKey = "ACME_HTML_Test_AllStepData";
			var initTest_Restore = function () {
				if (localStorage[Test_AllStepData_StoreKey]) {
					console.warn(Lang("ä»…ä¾›æµ‹è¯•ï¼šå·²ä¿å­˜æµ‹è¯•æ•°æ®ï¼Œè°ƒç”¨Test_Restore_StepXXX()è¿›è¡Œæ¢å¤æ­¥éª¤ç•Œé¢", "For testing only: test data has been saved, call Test_Restore_StepXXX() to restore the step interface", true));
				}
			}
			var Test_AllStepData_Restore = function (next) {
				var data = JSON.parse(localStorage[Test_AllStepData_StoreKey] || "{}");
				if (!data.StepData) throw new Error(Lang("æœªä¿å­˜æ•°æ®", "No data saved", true));
				for (var k in data) ACME[k] = data[k];

				var config = ACME.StepData.config;
				X509.KeyParse(config.privateKey, function (info) {
					config.privateKey = info;
					X509.KeyParse(config.accountKey, function (info) {
						config.accountKey = info;
						console.log("ACME.StepData", ACME.StepData);
						setTimeout(function () { next() });
					});
				});
			};
			window.Test_Restore_StepAuth = function () {
				Test_AllStepData_Restore(function () {
					console.warn(Lang("ä»…ä¾›æµ‹è¯•ï¼šå·²æ‰‹åŠ¨æ¢å¤æ­¥éª¤ä¸‰ç•Œé¢", "For testing only: Step 3 interface has been manually restored", true));
					verifyStepShow();
				});
			};
			window.Test_Restore_StepDownload = function () {
				Test_AllStepData_Restore(function () {
					console.warn(Lang("ä»…ä¾›æµ‹è¯•ï¼šå·²æ‰‹åŠ¨æ¢å¤æ­¥éª¤å››ç•Œé¢", "For testing only: Step 4 interface has been manually restored", true));
					downloadStepShow();
				});
			};



		})();
	</script>





	<script>
		//===================================================
		//================= ACME functions ==================
		//===================================================
		//LICENSE: GPL-3.0, https://github.com/xiangyuecn/ACME-HTML-Web-Browser-Client
		(function () {
			"use strict";

			/************** ACME client implementation **************/
			//RFC8555: https://www.rfc-editor.org/rfc/rfc8555.html
			window.ACME = {
				URL: ""
				, SyncID: 0
				, DirData: {}
				, Directory: function (True, False) {
					var id = ++ACME.SyncID;
					var url = ACME.URL, dirStoreKey = "ACME_HTML_cache_" + url;
					var ok = function (cache) {
						var data = cache.data;
						if (id != ACME.SyncID) return False("cancel");
						var meta = data.meta || {};
						if (!data.newOrder)
							return False("Not newOrder found: " + FormatText(JSON.stringify(data)));
						ACME.DirData = data;
						ACME.StepData.termsURL = meta.termsOfService;
						ACME.StepData.needEAB = !!meta.externalAccountRequired;
						var saveCache = function () {
							localStorage[dirStoreKey] = JSON.stringify(cache);
						};
						saveCache();
						True(cache, saveCache);
					};
					var cache = JSON.parse(localStorage[dirStoreKey] || '{}');//å…ˆè¯»ç¼“å­˜
					if (cache.time && Date.now() - cache.time < 24 * 60 * 60 * 1000) {
						return ok(cache);
					}
					request(url, null, function (data) {
						ok({ data: data, time: Date.now() });
					}, False);
				}

				, StepData: {}
				, ChallName: function (chall) { //éªŒè¯ç±»å‹åç§°
					if (chall.type == "dns-01") { // https://letsencrypt.org/docs/challenge-types/
						return Lang("DNSéªŒè¯", "DNS Verify");
					} else if (chall.type == "http-01") {
						return Lang("æ–‡ä»¶URLéªŒè¯", "File URL Verify");
					} // tls-alpn-01 https://www.rfc-editor.org/rfc/rfc8737
					return chall.type.toUpperCase();
				}
				, ChallSort: function (chall) { //éªŒè¯ç±»å‹æ’åº
					if (chall.type == "dns-01") return 1 + "_" + chall.type;
					else if (chall.type == "http-01") return 2 + "_" + chall.type;
					return 3 + "_" + chall.type;
				}
				// ç”ŸæˆJSON Web Signature(JWS)ï¼Œç”¨è´¦æˆ·ç§é’¥ç­¾å
				, GetJwsA: async function (Protected, Payload) {
					var key = ACME.StepData.config.accountKey;
					var alg = "ES256", algorithm = { name: "ECDSA", hash: "SHA-256" };
					if (key.type == "RSA") {
						alg = "RS256"; algorithm = { name: "RSASSA-PKCS1-v1_5" }
					}
					Protected.alg = alg;
					var rtv = {
						"protected": Json2UrlB64(Protected)
						, payload: Payload ? Json2UrlB64(Payload) : ""
					};
					var data = Str2Bytes(rtv["protected"] + "." + rtv.payload);
					var sign = await crypto.subtle.sign(algorithm, key.key, data);
					rtv.signature = Bytes2UrlB64(sign);
					return rtv;
				}
				// è·å¾—éšæœºæ•°Nonce
				, GetNonceA: function (useNew) {
					return new Promise(function (resolve, reject) {
						ACME.GetNonce(useNew, function (val) {
							resolve(val);
						}, function (err) {
							reject(new Error(err));
						});
					});
				}
				, GetNonce: function (useNew, True, False) {
					var old = ACME.PrevNonce; ACME.PrevNonce = "";
					if (!useNew && old) return True(old);//ä½¿ç”¨ä¸Šæ¬¡è°ƒç”¨è¿”å›çš„å€¼
					request({
						url: ACME.DirData.newNonce
						, method: "HEAD", response: false
					}, null, function (data, xhr) {
						ACME.PrevNonce = "";
						//è·¨åŸŸæ— è§£ Chrome ZeroSSL: Refused to get unsafe header "Replay-Nonce" , éœ€è¦ Access-Control-Expose-Headers: Link, Replay-Nonce, Location
						var val = xhr.getResponseHeader("Replay-Nonce");
						if (!val) {
							False("GetNonce: " + Lang('æ­¤ACMEæœåŠ¡å¯¹æµè§ˆå™¨è®¿é—®æ”¯æŒå¤ªå·®ï¼Œæ— æ³•è·¨åŸŸè·å–Replay-Nonceå“åº”å¤´ã€‚', 'This ACME service has too poor browser access support to get the Replay-Nonce response header across domains.'), true);
							return;
						}
						True(val);
					}, function (err) {
						False("GetNonce: " + err);
					});
				}
				//æµ‹è¯•è´¦æˆ·æ¥å£çš„è·¨åŸŸè®¿é—®
				, TestAccountCORS: function (True, False) {
					request({
						url: ACME.DirData.newAccount
						, method: "POST", response: false, nocheck: true
					}, {}, function (data, xhr) {
						if (xhr.status > 0) {
							True();
						} else {
							False("[" + xhr.status + "]", true);
						}
					}, function (err) {
						False(err);
					});
				}

				//è´¦æˆ·æ¥å£è°ƒç”¨
				, StepAccount: async function (True, False) {
					var id = ++ACME.SyncID;
					var tag = "ACME.StepAccount";
					CLog(tag, 0, "==========Account Start==========");
					var Err = "";
					try {
						await ACME._StepAccountA(id, tag);
					} catch (e) {
						Err = e.message || "-";
						CLog(tag, 1, Err, e);
					}
					CLog(tag, 0, "==========Account End==========");
					if (Err) False(Err)
					else True();
				}, _StepAccountA: async function (id, tag) {
					var url = ACME.DirData.newAccount, config = ACME.StepData.config;
					var accountData = {
						contact: ["mailto:" + config.email]
						, termsOfServiceAgreed: true
					};

					//externalAccountRequired https://github.com/fszlin/certes/blob/08bf850bbed9e026c718f56f1bcc454afafb4f92/src/Certes/Acme/AccountContext.cs
					if (ACME.StepData.needEAB) {
						var eab = {
							"protected": Json2UrlB64({ alg: "HS256", kid: config.eabKid, url: url })
							, payload: Json2UrlB64(X509.PublicKeyJwk(config.accountKey))
						};
						var key = await crypto.subtle.importKey("raw", UrlB642Bytes(config.eabKey)
							, { name: "HMAC", hash: "SHA-256" }, true, ["sign"]);
						var data = Str2Bytes(eab["protected"] + "." + eab.payload);
						var sign = await crypto.subtle.sign("HMAC", key, data);
						eab.signature = Bytes2UrlB64(sign);
						accountData.externalAccountBinding = eab;
						CLog(tag, 0, "externalAccountBinding", eab);
					};

					//ç»„è£…æˆjwsï¼Œè¯·æ±‚æ¥å£
					var sendData = await ACME.GetJwsA({
						jwk: X509.PublicKeyJwk(config.accountKey)
						, nonce: await ACME.GetNonceA(true)
						, url: url
					}, accountData);
					var resp = await requestA(url, sendData);
					if (id != ACME.SyncID) throw new Error("cancel");
					ACME.StepData.account = {
						url: xhrHeader(resp.xhr, "Location")
						, data: resp.data
					};
					CLog(tag, 0, "Account OK", ACME.StepData.account);
				}

				//è®¢å•æ¥å£è°ƒç”¨
				, StepOrder: async function (Progress, True, False) {
					var id = ++ACME.SyncID;
					var tag = "ACME.StepOrder";
					CLog(tag, 0, "==========Order Start==========");
					var Err = "";
					try {
						await ACME._StepOrderA(Progress, id, tag);
					} catch (e) {
						Err = e.message || "-";
						CLog(tag, 1, Err, e);
					}
					CLog(tag, 0, "==========Order End==========");
					if (Err) False(Err)
					else True();
				}, _StepOrderA: async function (Progress, id, tag) {
					var url = ACME.DirData.newOrder, config = ACME.StepData.config;
					var dnsArr = [];
					for (var i = 0; i < config.domains.length; i++) {
						dnsArr.push({ type: "dns", value: config.domains[i] });
					}
					var orderData = {
						identifiers: dnsArr
					};

					Progress("newOrder...");
					//ç»„è£…æˆjwsï¼Œè¯·æ±‚æ¥å£
					var sendData = await ACME.GetJwsA({
						kid: ACME.StepData.account.url
						, nonce: await ACME.GetNonceA()
						, url: url
					}, orderData);
					var resp = await requestA(url, sendData);
					if (id != ACME.SyncID) throw new Error("cancel");
					resp.data.orderUrl = xhrHeader(resp.xhr, "Location");
					ACME.StepData.order = resp.data;
					CLog(tag, 0, "Order OK", ACME.StepData.order);

					//å‡†å¤‡Key Authorizationséœ€è¦çš„å‚æ•° å‚è€ƒï¼šrfc8555 8.1
					var jwkStr = JSON.stringify(X509.PublicKeyJwk(config.accountKey));
					var thumbprint = await crypto.subtle.digest({ name: "SHA-256" }, Str2Bytes(jwkStr));
					thumbprint = Bytes2UrlB64(thumbprint);

					//è¯»å–æ‰€æœ‰çš„éªŒè¯ä¿¡æ¯
					var idfs = ACME.StepData.order.identifiers, bad = 0;
					var auths = ACME.StepData.order.authorizations;
					for (var i = 0; i < idfs.length; i++) {
						if (config.domains.indexOf(idfs[i].value) == -1) bad = 1;
					}
					if (bad || idfs.length != auths.length || idfs.length != config.domains.length)
						throw new Error(Lang("åˆ›å»ºçš„è®¢å•ä¸­çš„åŸŸåå’Œé…ç½®çš„ä¸ä¸€è‡´", "The domain name in the created order is inconsistent with the configuration"));
					if (id != ACME.SyncID) throw new Error("cancel");
					ACME.StepData.auths = {};
					for (var i = 0; i < auths.length; i++) {
						Progress("auth(" + (i + 1) + "/" + auths.length + ")...");
						var url = auths[i];
						var sendData = await ACME.GetJwsA({
							kid: ACME.StepData.account.url
							, nonce: await ACME.GetNonceA()
							, url: url
						}, "");
						var resp = await requestA(url, sendData);
						if (id != ACME.SyncID) throw new Error("cancel");
						resp.data.domain = idfs[i].value;
						resp.data.authUrl = url;
						ACME.StepData.auths[idfs[i].value] = resp.data;

						//ç”ŸæˆKey Authorizations
						var challs = resp.data.challenges;
						for (var i2 = 0; i2 < challs.length; i2++) {
							var chall = challs[i2];
							chall.authTxt = chall.token + "." + thumbprint;
							var sha = await crypto.subtle.digest({ name: "SHA-256" }
								, Str2Bytes(chall.authTxt));
							if (id != ACME.SyncID) throw new Error("cancel");
							chall.authTxtSHA256 = Bytes2UrlB64(sha);
							chall.authTxtSHA256Base64 = Bytes2Base64(sha);
						}
					}
					CLog(tag, 0, "Order Authorizations", ACME.StepData.auths);
				}

				//éªŒè¯ä¸€ä¸ªåŸŸå
				, StepVerifyAuthItem: async function (authItem, challIdx, True, False) {
					var tag = "ACME.verify[" + authItem.challenges[challIdx].type + "]:" + authItem.domain;
					var Err = "";
					try {
						await ACME._StepVerifyAuthItemA(authItem, challIdx, ACME.SyncID, tag, True, False);
					} catch (e) {
						Err = e.message || "-";
						CLog(tag, 1, Err, e);
					}
					if (Err) True(false, 1000, Err); //é‡è¯•
				}, _StepVerifyAuthItemA: async function (authItem, challIdx, id, tag, True, False) {
					//å…ˆé€šçŸ¥è¦ç”¨çš„éªŒè¯æ–¹å¼ï¼Œåå¤å‘é€åªè¦æˆåŠŸä¸€æ¬¡å³å¯ï¼Œä¸ç®¡ç»“æœ
					var chall = authItem.challenges[challIdx];
					if (!chall.isSend) {
						var url = chall.url;
						var sendData = await ACME.GetJwsA({
							kid: ACME.StepData.account.url
							, nonce: await ACME.GetNonceA()
							, url: url
						}, {});
						var resp = await requestA({ url: url, nocheck: true }, sendData);
						var status = resp.xhr.status;
						if (status >= 200 && status < 300)
							chall.isSend = true;
					}

					//é‡æ–°æŸ¥è¯¢ä¸€ä¸‹çŠ¶æ€
					var url = authItem.authUrl;
					var sendData = await ACME.GetJwsA({
						kid: ACME.StepData.account.url
						, nonce: await ACME.GetNonceA()
						, url: url
					}, "");
					var resp = await requestA(url, sendData);
					var data = resp.data;
					if (data.status == "pending") {
						CLog(tag, 0, "pending...");
						return True(false, 1000, "pending...");
					}
					if (data.status == "valid") {
						CLog(tag, 0, "valid OK");
						return True(true);
					}
					CLog(tag, 1, "Fail", data);
					return False(data.status + ": " + FormatText(JSON.stringify(data)));
				}

				//å®Œæˆè®¢å•ï¼Œç”Ÿæˆè¯ä¹¦
				, StepFinalizeOrder: async function (Progress, True, False) {
					var id = ++ACME.SyncID;
					var tag = "ACME.StepFinalizeOrder";
					CLog(tag, 0, "==========Finalize Start==========");
					var Err = "";
					try {
						await ACME._StepFinalizeOrderA(Progress, id, tag);
					} catch (e) {
						Err = e.message || "-";
						CLog(tag, 1, Err, e);
					}
					CLog(tag, 0, "==========Finalize End==========");
					if (Err) False(Err)
					else True();
				}, _StepFinalizeOrderA: async function (Progress, id, tag) {
					var order = ACME.StepData.order, config = ACME.StepData.config, domains = config.domains;

					//å…ˆè¯·æ±‚finalize
					if (!order.finalizeIsSend) {
						Progress("finalize...");
						//ç”Ÿæˆcsrï¼Œç¬¬ä¸€ä¸ªåŸŸååšCN
						var csr = await new Promise(function (resolve, reject) {
							X509.CreateCSR(config.privateKey, domains[0], domains, function (csr) {
								resolve(csr);
							}, function (err) {
								reject(new Error(err));
							});
						});
						order.orderCSR = csr;
						CLog(tag, 0, "CSR\n" + csr);
						csr = Bytes2UrlB64(ASN1.PEM2Bytes(csr));

						var url = order.finalize;
						//ç»„è£…æˆjwsï¼Œè¯·æ±‚æ¥å£
						var sendData = await ACME.GetJwsA({
							kid: ACME.StepData.account.url
							, nonce: await ACME.GetNonceA()
							, url: url
						}, { csr: csr });
						var resp = await requestA(url, sendData);
						if (id != ACME.SyncID) throw new Error("cancel");
						CLog(tag, 0, "finalize result", resp.data);
						order.finalizeIsSend = true;
					}

					//è½®è¯¢è®¢å•çŠ¶æ€ï¼Œ60ç§’è¶…æ—¶
					var t1 = Date.now(), tryCount = 0;
					while (!order.checkOK && Date.now() - t1 < 60 * 1000) {
						if (id != ACME.SyncID) throw new Error("cancel");
						tryCount++;
						Progress("check retry:" + tryCount + "...");
						var url = order.orderUrl;
						//ç»„è£…æˆjwsï¼Œè¯·æ±‚æ¥å£
						var sendData = await ACME.GetJwsA({
							kid: ACME.StepData.account.url
							, nonce: await ACME.GetNonceA()
							, url: url
						}, "");
						var resp = await requestA(url, sendData);
						if (id != ACME.SyncID) throw new Error("cancel");
						var data = resp.data;
						if (data.status == "valid") {
							order.checkOK = true;
							order.certUrl = data.certificate;
							CLog(tag, 0, "check OK", data);
							break;
						} else if (data.status == "invalid") {
							CLog(tag, 1, "check Fail", data);
							throw new Error(data.status + ": " + FormatText(JSON.stringify(data)));
						} else {
							CLog(tag, 0, data.status + "... wait 1s", data);
							await new Promise(function (s) { setTimeout(s, 1000) });
						}
					}

					//ä¸‹è½½è¯ä¹¦
					if (!order.downloadPEM) {
						Progress("download...");
						var url = order.certUrl;
						//ç»„è£…æˆjwsï¼Œè¯·æ±‚æ¥å£
						var sendData = await ACME.GetJwsA({
							kid: ACME.StepData.account.url
							, nonce: await ACME.GetNonceA()
							, url: url
						}, "");
						var resp = await requestA({ url: url, response: false }, sendData);
						if (id != ACME.SyncID) throw new Error("cancel");
						var pem = resp.xhr.responseText;
						order.downloadPEM = pem;
						CLog(tag, 0, "download OK\n" + pem);
					}
				}
			};


			// è¯»å–å“åº”å¤´ï¼Œè¯»ä¸åˆ°å°±å½“åšè·¨åŸŸæ— æ³•è¯»å–å¤„ç†ï¼Œè‡ªå®šä¹‰çš„å¤´éœ€è¦ Access-Control-Expose-Headers: Link, Replay-Nonce, Location
			var xhrHeader = function (xhr, key) {
				var val = xhr.getResponseHeader(key);
				if (!val) {
					acmeReadDirGotoCORS();
					throw new Error(Lang("æ— æ³•è¯»å–å“åº”å¤´" + key + "ï¼Œå¯èƒ½æ˜¯å› ä¸ºæ­¤ACMEæœåŠ¡å¯¹è·¨åŸŸè®¿é—®æ”¯æŒä¸è‰¯ï¼Œè¯·æŒ‰ç¬¬ä¸€æ­¥æ˜¾ç¤ºçš„æç¤ºæ“ä½œã€‚"
						, "The response header " + key + " cannot be read, This may be because this ACME service does not support cross domain access, Please follow the prompt displayed in step 1."));
				}
				return val;
			};

			// ajax
			var requestA = function (url, post) {
				return new Promise(function (resolve, reject) {
					request(url, post, function (data, xhr) {
						resolve({ data: data, xhr: xhr });
					}, function (err) {
						reject(new Error(err));
					});
				});
			}
			var request = function (url, post, True, False) {
				var set = typeof (url) == "string" ? { url: url } : url; url = set.url;
				var method = set.method || (post ? "POST" : "GET");
				var tag = "ACME.Request"; CLog(tag, 4, "send " + method, set, post);

				var xhr = new XMLHttpRequest();
				xhr.timeout = 30000;
				xhr.open(method, url, true);
				xhr.onreadystatechange = function () {
					if (xhr.readyState == 4) {
						ACME.PrevNonce = xhr.getResponseHeader("Replay-Nonce") || "";//å°†æ­¤å€¼å­˜èµ·æ¥

						var isBad = xhr.status < 200 || xhr.status >= 300;
						var useResp = set.response == null || set.response;
						var err = "", data, logObj;
						if (useResp || isBad) {
							logObj = xhr.responseText;
							try {
								data = JSON.parse(logObj);
								logObj = data;
							} catch (e) { };
						}
						CLog(tag, 4, "send End", set, {
							status: xhr.status
							, headers: xhr.getAllResponseHeaders()
						}, logObj);
						if (set.nocheck || !isBad && (!useResp || data)) {
							return True(data, xhr);
						}
						False((isBad ? "[" + xhr.status + "]" : "") + FormatText(xhr.responseText), xhr.status);
					}
				};
				if (post) {
					if (typeof (post) == "object") post = JSON.stringify(post);
					xhr.setRequestHeader("Content-Type", set.contentType || "application/jose+json");
					xhr.send(post);
				} else {
					xhr.send();
				}
			};

		})();
	</script>





	<script>
		//==================================================================
		//================= RSA/ECC/X.509/ASN.1 functions ==================
		//==================================================================
		//LICENSE: GPL-3.0, https://github.com/xiangyuecn/ACME-HTML-Web-Browser-Client
		(function () {
			"use strict";

			window.X509 = {
				DefaultType2_RSA: "2048" //é»˜è®¤åˆ›å»ºRSAå¯†é’¥ä½æ•°
				, DefaultType2_ECC: "P-256" //é»˜è®¤åˆ›å»ºECCæ›²çº¿
				, SupportECCType2: { //æ”¯æŒçš„ECCæ›²çº¿å’Œå¸¸è§åç§°
					"P-256": "prime256v1", "P-384": "secp384r1", "P-521": "secp521r1"
				}
				, SupportECCType2Names: function () { var str = []; for (var k in X509.SupportECCType2) str.push(X509.SupportECCType2[k]); return str; }

				//åˆ›å»ºRSA/ECCå¯†é’¥å¯¹ type2å–å€¼ï¼štype=RSAæ—¶ä¸ºå¯†é’¥ä½æ•°æ•°å€¼ï¼Œtype=ECCæ—¶ä¸ºæ”¯æŒçš„æ›²çº¿ï¼ˆX509.SupportECCType2ï¼‰
				, KeyGenerate: function (type, type2, True, False) {
					var algorithm = 0;
					if (type == "RSA") {
						algorithm = {
							publicExponent: new Uint8Array([1, 0, 1]) //E: AQAB
							, name: "RSASSA-PKCS1-v1_5", modulusLength: +type2, hash: "SHA-256"
						};
					} else if (type == "ECC") {
						algorithm = { name: "ECDSA", namedCurve: type2 };
					} else {
						False("Not support " + type);
						return;
					};
					crypto.subtle.generateKey(algorithm, true, ["sign", "verify"])
						.then(function (key) {
							//FireFoxä¸æ”¯æŒå¯¼å‡ºpkcs8å‚æ•°çš„ECCç§é’¥ï¼ŒChromeæ²¡é—®é¢˜ï¼Œä½¿ç”¨jwkè·å¾—æœ€å¤§å…¼å®¹
							crypto.subtle.exportKey("jwk", key.privateKey).then(function (jwk) {
								True(X509.KeyExport(jwk));
							}).catch(function (e) {
								False(Lang('æ­¤æµè§ˆå™¨ä¸æ”¯æŒå¯¼å‡º' + algorithm.name + '+PKCS#8æ ¼å¼å¯†é’¥ï¼š', 'This browser does not support exporting ' + algorithm.name + '+PKCS#8 format keys: ') + e.message);
							});
						}).catch(function (e) {
							False(Lang('æ­¤æµè§ˆå™¨ä¸æ”¯æŒç”Ÿæˆ' + algorithm.name + 'ï¼š', 'This browser does not support generating ' + algorithm.name + ': ') + e.message);
						});
				}
				//è§£æå¯†é’¥ï¼Œæ£€æŸ¥æ˜¯å¦æ”¯æŒï¼Œé€šè¿‡å›è°ƒè¿”å›æ ¼å¼æˆ–é”™è¯¯ä¿¡æ¯ï¼Œpemæ”¯æŒå…¬é’¥å’Œç§é’¥
				, KeyParse: function (pem, True, False, mustPrivate) {
					var rtv = {};
					var Err = function (msg) { rtv.error = msg; False(msg, rtv); };
					//æµè§ˆå™¨cryptoä¸æ”¯æŒPKCS#1çš„pemå¯¼å…¥ï¼Œæå–å‚æ•°è½¬æˆjwkå¯¼å…¥

					if (!/BEGIN\s*(RSA|EC)?\s*(PUBLIC|PRIVATE)\s*KEY/.test(pem))
						return Err(Lang('ä¸æ˜¯RSAæˆ–ECCå¯†é’¥', 'Not an RSA or ECC key'));
					rtv.type = RegExp.$1 == "EC" ? "ECC" : RegExp.$1;
					var isPKCS1 = !!RegExp.$1;
					var isPub = RegExp.$2 == "PUBLIC";
					if (isPub && mustPrivate)
						return Err(Lang('ä¸æ˜¯ç§é’¥', 'Is not a private key'));

					//è§£ææå–å‚æ•°ä¿¡æ¯
					try {
						var paramAsn1 = null;
						var asn1 = ASN1.ParsePEM(pem);
						rtv.asn1 = asn1;

						if (isPKCS1) {
							if (rtv.type == "RSA") {
								paramAsn1 = asn1; //ç›´æ¥æŒ‰é¡ºåºå­˜æ”¾çš„å‚æ•°
							} else if (rtv.type == "ECC") {
								if (isPub) //æ²¡è§è¿‡è¿™ç§eccå…¬é’¥
									return Err(Lang('ä¸æ”¯æŒECC PKCS#1æ ¼å¼å…¬é’¥', 'ECC PKCS#1 format public key is not supported'));
								var oid2 = asn1.sub[2].sub[0].oid;
								rtv.type2 = ASN1.OID[oid2] || "";
								paramAsn1 = asn1;
							}
						} else {
							var idx = isPub ? 0 : 1; //è·³è¿‡ç§é’¥å¼€å¤´çš„versionï¼Œå°±å’Œå…¬é’¥ä¸€æ ·äº†
							var oid = asn1.sub[idx].sub[0].oid;
							var oid2 = asn1.sub[idx].sub[1].oid;
							rtv.type = ASN1.OID[oid] || "";
							rtv.type2 = ASN1.OID[oid2] || "";

							if (rtv.type == "ECC" && isPub)//ECCå…¬é’¥ç›´æ¥å°±æ˜¯å€¼
								paramAsn1 = asn1;
							else
								paramAsn1 = new ASN1().parse(asn1.sub[idx + 1].bytes);//å¯†é’¥å‚æ•°
						}
						rtv.paramAsn1 = paramAsn1;
					} catch (e) {
						return Err(Lang('å¯†é’¥è§£æå¤±è´¥ï¼š', 'Key resolution failed: ') + e.message);
					}
					if (rtv.type == "RSA") {
						var idx = isPub ? 0 : 1; //ç§é’¥å¼€å¤´å¤šä¸€ä¸ªç‰ˆæœ¬å·
						rtv.param = {
							n: paramAsn1.sub[idx].bytes //Modulus
							, e: paramAsn1.sub[idx + 1].bytes //Exponent
							, d: isPub ? null : paramAsn1.sub[idx + 2].bytes //D
						};
						var keys = "p,q,dp,dq,qi".split(",");
						for (var i = 0; i < 5; i++)
							rtv.param[keys[i]] = isPub ? null : paramAsn1.sub[idx + 3 + i].bytes;
						rtv.type2 = rtv.param.n.length * 8 + "";
					} else if (rtv.type == "ECC") {
						if (!X509.SupportECCType2[rtv.type2]) {
							return Err(Lang('åªæ”¯æŒ' + X509.SupportECCType2Names().join("ã€") + 'æ›²çº¿çš„ECCå¯†é’¥', 'ECC key only supported for ' + X509.SupportECCType2Names().join(",") + ' curve'));
						}
						if (isPub) {
							var b2 = paramAsn1.sub[1].bytes;
						} else {
							var idx = isPKCS1 ? 3 : 2;
							var b2 = paramAsn1.sub[idx].sub[0].bytes;
						}
						if (b2[0] != 0x04)//0x04ä»£è¡¨å…¬é’¥æœªå‹ç¼© https://www.rfc-editor.org/rfc/rfc5480#section-2.2
							return Err("ECC !0x04: " + b2[0]);
						var bits = (b2.length - 1) / 2;
						rtv.param = {
							x: b2.slice(1, 1 + bits) //xyä¸ºå…¬é’¥
							, y: b2.slice(1 + bits)
							, d: isPub ? null : paramAsn1.sub[1].bytes //D
						};
					} else {
						return Err(Lang('ä¸æ”¯æŒçš„å¯†é’¥ç±»å‹ï¼š', 'Unsupported key type: ') + oid);
					}
					rtv.isPKCS1 = isPKCS1;
					rtv.hasPrivate = !isPub;
					rtv.pem = pem;

					//è½¬æˆCryptoKey
					var algorithm, jwk;
					if (rtv.type == "RSA") {
						algorithm = {
							publicExponent: new Uint8Array(rtv.param.n.buffer)
							, name: "RSASSA-PKCS1-v1_5", modulusLength: +rtv.type2, hash: "SHA-256"
						};
						jwk = { kty: "RSA", alg: "RS256" };
					} else if (rtv.type == "ECC") {
						algorithm = { name: "ECDSA", namedCurve: rtv.type2 };
						jwk = { kty: "EC", crv: rtv.type2 };
					}
					jwk = Object.assign(jwk, { ext: true, key_ops: [isPub ? "verify" : "sign"] });
					for (var k in rtv.param)
						rtv.param[k] && (jwk[k] = Bytes2UrlB64(rtv.param[k]));

					crypto.subtle.importKey(
						"jwk", jwk, algorithm, true, [isPub ? "verify" : "sign"]
					).then(function (key) {
						rtv.key = key;
						True(rtv);
					}).catch(function (e) {
						Err(Lang('å¯†é’¥è½¬æˆCryptoKeyå¤±è´¥ï¼š', 'Failed to convert key to CryptoKey: ') + e.message);
					});
				}
				//è§£æå‡ºæ¥çš„å…¬é’¥è½¬æ¢æˆJSON Web Key(JWK)
				, PublicKeyJwk: function (info) { // https://www.rfc-editor.org/rfc/rfc7638
					var p = info.param;
					if (info.type == "RSA") {
						return { e: Bytes2UrlB64(p.e), kty: "RSA", n: Bytes2UrlB64(p.n) };
					} else if (info.type == "ECC") {
						return { crv: info.type2, kty: "EC", x: Bytes2UrlB64(p.x), y: Bytes2UrlB64(p.y) };
					} else {
						throw new Error("Jwk: " + info.type);
					}
				}
				//è§£æå‡ºæ¥çš„å¯†é’¥æˆ–jwkå¯¹è±¡è½¬æˆPKCS#8æ ¼å¼ publicOnlyï¼šæä¾›ç§é’¥æ—¶ä»…å¯¼å‡ºå…¬é’¥ returnTypeï¼š1 bytesï¼Œ2 asn1ï¼Œother pem
				, KeyExport: function (info, publicOnly, returnType) {
					var tag = "KeyExport: ", S = ASN1.S, V = ASN1.V; //ASN1å¿«æ·åˆ›å»ºæ–¹å¼
					var param = info.param, type = param && info.type, type2 = info.type2;//è§£æå‡ºæ¥çš„æ ¼å¼
					if (!param) {//jwk
						if (info.kty) {
							type = info.kty == "EC" ? "ECC" : info.kty;
							if (type == "ECC") type2 = info.crv;
						} else throw new Error(tag + "bad key");
					}
					var keys = (type == "ECC" ? "x,y,d" : "n,e,d,p,q,dp,dq,qi").split(",");
					if (!param) {//jwkå‚æ•°éœ€è½¬æˆäºŒè¿›åˆ¶
						param = {};
						for (var i = 0; i < keys.length; i++) {
							var k = keys[i], b64 = info[k];
							if (b64) param[k] = UrlB642Bytes(b64);
						}
					}
					var useD = !publicOnly && param.d;//å¯¼å‡ºç§é’¥

					var bytes;//å°è£…å‚æ•°
					if (type == "RSA") {
						var asn1 = S(0x30, V(0x02, param.n), V(0x02, param.e));
						if (useD) {//å…¬é’¥åªéœ€nã€eå‚æ•°ï¼Œç§é’¥è¦å…¨éƒ¨
							asn1.sub.splice(0, 0, V(0x02, [0]));//å¼€å¤´æ’å…¥ç‰ˆæœ¬å·
							for (var i = 2; i < keys.length; i++) {
								asn1.push(V(0x02, param[keys[i]]));
							}
						}
						bytes = asn1.toBytes();
					} else if (type == "ECC") { //å…¬é’¥xã€yå‚æ•°ï¼Œç§é’¥å¤–é¢å†å¥—ä¸€å±‚d
						var pubB = new Uint8Array(1 + param.x.length * 2); pubB[0] = 0x04;
						pubB.set(param.x, 1);
						pubB.set(param.y, 1 + param.x.length);
						if (useD) {
							bytes = S(0x30, V(0x02, [1]), V(0x04, param.d)
								, S(0xA1, V(0x03, pubB))).toBytes();
						} else bytes = pubB;
					} else { throw new Error(tag + type); }

					var typeASN1 = S(0x30 //å°è£…ç±»å‹
						, V(0x06, ASN1.OID2Bytes(ASN1.OID[type]))
						, type == "RSA" ? V(0x05, [])
							: V(0x06, ASN1.OID2Bytes(ASN1.OID[type2]))
					);

					if (useD) {//å°è£…ç§é’¥
						var keyA = S(0x30, V(0x02, [0]), typeASN1, V(0x04, bytes));
					} else { //å°è£…å…¬é’¥
						var keyA = S(0x30, typeASN1, V(0x03, bytes));
					};
					if (returnType == 2) return keyA;
					bytes = keyA.toBytes();
					if (returnType == 1) return bytes;
					var str = Bytes2Base64(bytes).replace(/(.{64})/g, "$1\n").trim();
					var sp = useD ? "PRIVATE" : "PUBLIC";
					return '-----BEGIN ' + sp + ' KEY-----\n' + str + '\n-----END ' + sp + ' KEY-----';
				}


				//åˆ›å»ºè¯ä¹¦è¯·æ±‚CSRï¼Œæä¾›ç§é’¥ç”¨äºCSRç­¾å
				, CreateCSR: function (keyInfo, commonName, domains, True, False) {
					//CSRæ ¼å¼ï¼šrfc2986ï¼Œå¤ªå¤æ‚äº†ï¼Œç›´æ¥æ‹¿opensslç”Ÿæˆcsrç”¨ASN1.ParsePEMæ¥è§‚çœ‹æ ¼å¼
					var S = ASN1.S, V = ASN1.V; //ASN1å¿«æ·åˆ›å»ºæ–¹å¼

					//å°è£…å…¬é’¥
					try {
						var pubA = X509.KeyExport(keyInfo, true, 2);
					} catch (e) { return False(e.message) }

					//å°è£…åŸŸååˆ—è¡¨æ‰©å±•å±æ€§
					var altNameA = S(0x30);
					for (var i = 0; i < domains.length; i++)
						altNameA.push(V(0x82, Str2Bytes(domains[i])));

					//ç»„è£…CSRä¸»ä½“
					var bodyA = S(0x30
						, V(0x02, [0]) //ç‰ˆæœ¬å· å›ºå®šå€¼0
						, S(0x30, S(0x31, S(0x30 //åªæä¾›ä¸€ä¸ªå±æ€§ï¼šCN
							, V(0x06, ASN1.OID2Bytes("2.5.4.3"))
							, V(0x0C, Str2Bytes(commonName))
						)))
						, pubA //å…¬é’¥
						, S(0xA0, S(0x30 //æ‰©å±•å±æ€§ï¼ŒåŸŸååˆ—è¡¨
							, V(0x06, ASN1.OID2Bytes("1.2.840.113549.1.9.14"))
							, S(0x31, S(0x30, S(0x30
								, V(0x06, ASN1.OID2Bytes("2.5.29.17"))
								, V(0x04, altNameA.toBytes())
							)))
						))
					);

					//ç­¾åç”ŸæˆCSR rfc2315
					var bodyBytes = bodyA.toBytes();
					var algorithm = { name: "ECDSA", hash: "SHA-256" };
					if (keyInfo.type == "RSA") {
						algorithm = { name: "RSASSA-PKCS1-v1_5" }
					}
					crypto.subtle.sign(algorithm, keyInfo.key, bodyBytes).then(function (arr) {
						var signBytes = new Uint8Array(arr);
						if (keyInfo.type == "ECC") {//ECCåˆ†ä¸¤æ®µé‡æ–°å°è£…ä¸€ä¸‹
							var s1 = signBytes.subarray(0, keyInfo.param.x.length);
							var s2 = signBytes.subarray(keyInfo.param.x.length);
							signBytes = S(0x30, V(0x02, s1), V(0x02, s2)).toBytes();
						}
						var csrA = S(0x30, bodyA
							, S(0x30 //ç­¾åç±»å‹
								, V(0x06, ASN1.OID2Bytes(ASN1.OID["SHA256_" + keyInfo.type]))
								, keyInfo.type == "RSA" ? V(0x05, []) : null //ECCæ²¡æœ‰ç¬¬äºŒä¸ªå‚æ•°
							)
							, V(0x03, signBytes)
						);
						var bytes = csrA.toBytes();
						var str = Bytes2Base64(bytes).replace(/(.{64})/g, "$1\n").trim();
						True('-----BEGIN CERTIFICATE REQUEST-----\n' + str + '\n-----END CERTIFICATE REQUEST-----');
					}).catch(function (e) {
						False("CSR sign:" + e.message);
					});
				}
			};



			//ç®€å•å®ç°ASN.1è§£æå’Œå°åŒ…
			window.ASN1 = function (tag, bytes) {
				this.sub = [];
				if (tag) this.setTag(tag);
				if (bytes) this.setBytes(bytes);
			};
			ASN1.S = function (tag) { //å¿«æ·åˆ›å»ºå®¹å™¨ç±»å‹ï¼Œå¹¶æä¾›ä»»æ„å¤šä¸ªå­å…ƒç´ 
				var v = new ASN1(tag);
				for (var i = 1, a = arguments; i < a.length; i++) { a[i] && v.push(a[i]) }
				return v;
			};
			ASN1.V = function (tag, bytes) { //å¿«æ·åˆ›å»ºå€¼ç±»å‹
				return new ASN1(tag, bytes)
			};
			ASN1.ParsePEM = function (pem) {
				return new ASN1().parsePEM(pem);
			};
			ASN1.TagNames = {
				'01': 'BOOLEAN', '02': 'INTEGER', '03': 'BIT_STRING'
				, '04': 'OCTET_STRING', '05': 'NULL', '06': 'OID'
				, '0C': 'UTF8String', '13': 'Printable_String'
				, '17': 'UTCTime', '18': 'GeneralizedTime', '30': 'SEQUENCE', '31': 'SET'
			};
			ASN1.OID = {
				"1.2.840.113549.1.1.1": "RSA"
				, "1.2.840.113549.1.1.11": "SHA256_RSA"
				, "1.2.840.10045.2.1": "ECC"
				, "1.2.840.10045.4.3.2": "SHA256_ECC"
				, "1.2.840.10045.3.1.7": "P-256" //secp256r1 | prime256v1
				, "1.3.132.0.34": "P-384" //secp384r1
				, "1.3.132.0.35": "P-521" //secp521r1
			}; for (var k in ASN1.OID) ASN1.OID[ASN1.OID[k]] = k;
			ASN1.OID2Bytes = function (oid) {
				var arr = oid.split('.'), byts = [];
				var v0 = +arr[0], v1 = +arr[1];
				if (!/^[\d\.]+$/.test(oid) || arr.length < 3 || v0 > 2 || v0 * 40 + v1 > 0xff)
					throw new Error("bad oid: " + oid);
				byts.push(v0 * 40 + v1);
				for (var i = 2, len = arr.length; i < len; i++) {
					var num = +arr[i], bits = [];
					while (num >= 0x80) { bits.push(num % 0x80); num /= 0x80; }
					bits.push(num); bits.reverse();
					for (var j = 0, jl = bits.length - 1; j <= jl; j++) {
						if (j != jl) {
							byts.push(0x80 + bits[j]);
						} else {
							byts.push(bits[j]);
						}
					}
				}
				return new Uint8Array(byts);
			};
			ASN1.OID2Text = function (bytes) {
				var str = "", b0 = bytes[0];
				var m = b0 < 80 ? b0 < 40 ? 0 : 1 : 2;
				str += m + "." + (b0 - m * 40);
				for (var i = 1, len = bytes.length; i < len;) {
					var num = 0;
					for (; i < len;) {
						var bit = bytes[i++]; num *= 0x80;
						if (bit >= 0x80) num += bit - 0x80;
						else { num += bit; break; }
					}
					str += "." + num;
				}
				return str;
			};
			ASN1.ParseSize = function (pos, bytes) { //ç®€å•è§£æé•¿åº¦æ•°å€¼
				var bitCount = bytes[pos[0]++], size = 0;
				if (bitCount < 0x80) size = bitCount;
				else if (bitCount == 0x80) size = -404; //ä¸å®šé•¿ï¼Œéœ€æœç´¢ä¸¤ä¸ª0ç»“å°¾ï¼Œç›´æ¥æ‹’ç»æ”¯æŒ
				else for (var i = 0, len = bitCount & 0x7F; i < len; i++)
					size = size * 256 + bytes[pos[0]++];
				if (size < 0 || size > bytes.length - pos[0]) throw new Error("ASN.1 Bad size " + size);
				return size;
			};
			ASN1.ParseBlock = function (pos, bytes, sub) { //ç®€å•è§£æä¸€å—å­å†…å®¹
				sub = sub || [];
				while (pos[0] < bytes.length) {
					var idx0 = pos[0], item = new ASN1();
					var tag = bytes[pos[0]++], size = ASN1.ParseSize(pos, bytes);
					if ((tag & 0x20) != 0) {//ç»“æ„åŒ–å®¹å™¨ï¼ŒåµŒå¥—è°ƒç”¨
						item.parse(bytes.slice(idx0, pos[0] + size));
					} else {//æ™®é€šå†…å®¹
						var chunk = bytes.slice(pos[0], pos[0] + size);
						if (tag == 0x02 || tag == 0x03) {//å»æ‰å¼€å¤´è¡¥çš„0ï¼Œæ­£æ•´æ•°
							if (chunk.length > 1 && chunk[0] == 0) {
								chunk = chunk.slice(1);
							}
						}
						item.setTag(tag);
						item.setBytes(chunk);
					}
					sub.push(item);
					pos[0] += size;
				}
				return sub;
			};
			ASN1.PEM2Bytes = function (pem) {
				pem = pem.replace(/[\s\r\n]/g, "");
				var m = /^-+BEGIN\w*-+([^-]+)-+END\w+-+$/i.exec(pem);
				try {
					return Base642Bytes(m[1]);
				} catch (e) {
					throw new Error(Lang('ä¸æ˜¯pemæ ¼å¼ã€‚', 'Not a pem format.'));
				}
			};
			ASN1.prototype = {
				setTag: function (tag) {
					var txt = (tag < 16 ? "0" : "") + tag.toString(16).toUpperCase();
					this.tag = tag;
					this.tagTxt = txt;
					this.tagName = ASN1.TagNames[txt] || "0x" + txt;
				}
				, setBytes: function (bytes) {
					if (bytes.length == null || (bytes.slice == null && bytes.subarray == null))
						throw new Error("Not Array");
					if (this.tag == 0x06) this.oid = ASN1.OID2Text(bytes);
					if (this.tag == 0x0C || this.tag == 0x13) this.string = Bytes2Str(bytes);
					this.bytes = bytes;
				}
				, push: function (asn1) {
					if (!asn1.parsePEM) throw new Error("Not ASN1");
					this.sub.push(asn1);
					return this;
				}
				, parsePEM: function (pem) {
					return this.parse(ASN1.PEM2Bytes(pem));
				}
				, parse: function (bytes) {
					var pos = [0];
					//æœ€å¤–å±‚å¿…é¡»æ˜¯ä¸ªç»“æ„åŒ–å®¹å™¨ï¼Œç¬¬6ä½ä¸º1ï¼Œä¸º0ä¸ºåŸºç¡€ç±»å‹ https://www.jianshu.com/p/ce7ab5f3f33a
					if ((bytes[0] & 0x20) == 0) throw new Error("ASN.1 parse: Not SEQ");
					this.setTag(bytes[pos[0]++]);
					var size = ASN1.ParseSize(pos, bytes);
					bytes = bytes.slice(pos[0], pos[0] + size);
					this.setBytes(bytes);
					//è§£æå­å†…å®¹
					ASN1.ParseBlock([0], bytes, this.sub);
					return this;
				}
				, toBytes: function (innerOlny) {
					var chunks = [], len = 0;
					if (this.sub.length) {//å®¹å™¨ç±»å‹ï¼Œé€’å½’è°ƒç”¨
						for (var i = 0; i < this.sub.length; i++) {
							var arr = this.sub[i].toBytes();
							chunks.push(arr); len += arr.length;
						}
					} else if (this.bytes && this.bytes.length) {//ç®€å•ç±»å‹
						if (this.tag == 0x02 && this.bytes[0] >= 0x80 || this.tag == 0x03) {
							chunks.push([0]); len++;  //0x02è´Ÿæ•° 0x03éœ€è¦å¼€å¤´è¡¥0
						}
						chunks.push(this.bytes); len += this.bytes.length;
					}
					if (!innerOlny) {//æ·»åŠ æ ‡ç­¾å’Œé•¿åº¦
						var arr = [], num = len;
						if (num < 0x80) arr.push(num);
						else {
							while (num > 0xff) { arr.push(num & 0xff); num = num >> 8; }
							arr.push(num & 0xff); arr.push(0x80 + arr.length);
						}
						arr.push(this.tag); arr.reverse();
						chunks.splice(0, 0, arr); len += arr.length;
					}
					var bytes = new Uint8Array(len), n = 0;
					for (var i = 0; i < chunks.length; i++) {
						var arr = chunks[i];
						bytes.set(arr, n); n += arr.length;
					}
					return bytes;
				}
			};

		})();
	</script>







	<script>
		//===========================================================
		//================= Common functions ==================
		//===========================================================
		//LICENSE: GPL-3.0, https://github.com/xiangyuecn/ACME-HTML-Web-Browser-Client
		(function () {
			"use strict";

			/************** Language **************/
			window.LangCur = /\b(zh|cn)\b/i.test(("" + navigator.language).replace(/_/g, " ")) ? "cn" : "en";
			window.Lang = function (cn, en, txt) {
				if ((cn || en) && (!cn || !en)) throw new Error("Lang bad args");
				if (txt) return LangCur == "cn" ? cn : en;
				var html = "", ks = { cn: cn, en: en };
				for (var k in ks) {
					html += (LangCur != k ? '<!--LangHide1--> ' :'')
						+ '<span class="lang' + k.toUpperCase()
						+ '" style="' + (LangCur == k ? '' : 'display:none')
						+ '">' + ks[k] + '</span>'
						+ (LangCur != k ? '<!--LangHide2-->' : '');
				}
				return html;
			};
			window.LangReview = function (cls) {
				var el = $(cls || "body");
				el.find(".langCN")[LangCur == "cn" ? "show" : "hide"]();
				el.find(".langEN")[LangCur != "cn" ? "show" : "hide"]();
				var inputs = el.find(".inputLang");
				for (var i = 0; i < inputs.length; i++)
					inputs[i].setAttribute("placeholder", inputs[i].getAttribute("placeholder-" + LangCur));
			};
			window.LangClick = function (lang) {
				LangCur = lang;
				LangReview();
				$(".langBtn").css("color", null);
				$(".langBtn_" + lang).css("color", "#000");
				$("body").css("wordBreak", lang == "cn" ? "break-all" : null);

				if (!document.titleLang) document.titleLang = document.title;
				var arr = document.titleLang.split("|"), t1 = [], t2 = [];
				for (var i = 0; i < arr.length; i++)
					if (/[^\x00-\xff]/.test(arr[i]) == (LangCur == "cn")) t1.push(arr[i].trim());
					else t2.push(arr[i].trim());
				document.title = t1.concat(t2).join(" | ");
			};


			/************** Console log output **************/
			window.CLog = function (tag, color, msg) {
				var now = new Date();
				var t = ("0" + now.getMinutes()).substr(-2)
					+ ":" + ("0" + now.getSeconds()).substr(-2)
					+ "." + ("00" + now.getMilliseconds()).substr(-3);
				msg = msg.replace(/<!--LangHide1[\S\s]+?LangHide2-->/g, "");//å»æ‰æ²¡æœ‰æ˜¾ç¤ºçš„è¯­è¨€
				msg = msg.replace(/<[^>]+>/g, "");
				var arr = ["[" + t + " " + tag + "]" + msg];
				for (var i = 3; i < arguments.length; i++) {
					arr.push(arguments[i]);
				};
				var fn = color == 1 ? console.error : color == 3 ? console.warn : color == 4 ? console.debug : console.log;
				fn.apply(console, arr);
				return msg;
			};


			/************** $ Selector / like jQuery **************/
			(function () {
				window.$ = function (cls) { if (cls && cls.is$) return cls; return new fn(cls) }
				var fn = function (cls, node) {
					this.length = 0;
					if (!cls) return;
					if (cls.appendChild) { this.push(cls); return }
					var arr = (node || document).querySelectorAll(cls);
					for (var i = 0; i < arr.length; i++)this.push(arr[i]);
				};
				fn.prototype = {
					is$: 1
					, push: function (val) { this[this.length++] = val }
					, find: function (cls) { var el0 = this[0]; return new fn(el0 ? cls : "", el0) }
					, val: function (val) { return this.prop("value", val) }
					, hide: function () { return this.css("display", "none") }
					, show: function (display) { return this.css("display", display === undefined ? null : display) }

					, html: function (html) {
						var el0 = this[0];
						if (html === undefined) return el0 && el0.innerHTML || "";
						for (var i = 0; i < this.length; i++) this[i].innerHTML = html;
						return this;
					}
					, append: function (html) { return this._end(html) }
					, prepend: function (html) { return this._end(html, 1) }
					, _end: function (html, prep) {
						var el0 = this[0];
						if (html && el0) {
							var nodes = html;
							if (typeof (html) == "string") {
								var div = document.createElement("div");
								div.innerHTML = html;
								nodes = [];
								for (var i = 0; i < div.childNodes.length; i++)nodes.push(div.childNodes[i]);
							} else if (html.appendChild) {
								nodes = [html];
							}
							if (prep) prep = el0.firstChild;
							for (var i = 0; i < nodes.length; i++) {
								if (prep) el0.insertBefore(nodes[i], prep);
								else el0.appendChild(nodes[i])
							}
						}
						return this;
					}
					, prop: function (key, val) {
						var el0 = this[0];
						if (val === undefined) return el0 && el0[key];
						for (var i = 0; i < this.length; i++) this[i][key] = val;
						return this;
					}
					, attr: function (key, val) {
						var el0 = this[0];
						if (val === undefined) return el0 && el0.getAttribute(key);
						for (var i = 0; i < this.length; i++) {
							if (val == null) this[i].removeAttribute(key);
							else this[i].setAttribute(key, val);
						}
						return this;
					}
					, css: function (key, val) {
						for (var i = 0; i < this.length; i++)
							this[i].style[key] = val;
						return this;
					}
					, bind: function (type, fn) {
						for (var i = 0; i < this.length; i++)
							this[i].addEventListener(type, fn);
						return this;
					}
				};
			})();


			/************** functions **************/
			window.FormatText = function (str) {
				return str.replace(/[&<>='"]/g, function (a) { return "&#" + a.charCodeAt(0) + ";" });
			};

			window.Str2Bytes = function (str) {
				str = unescape(encodeURIComponent(str));
				var u8arr = new Uint8Array(str.length);
				for (var i = 0; i < str.length; i++)u8arr[i] = str.charCodeAt(i);
				return u8arr;
			};
			window.Bytes2Str = function (bytes) {
				var str = "";
				for (var i = 0; i < bytes.length; i++) str += String.fromCharCode(bytes[i]);
				return decodeURIComponent(escape(str));
			};
			window.Json2UrlB64 = function (data) {
				return Bytes2UrlB64(JSON.stringify(data));
			};
			window.Base642Bytes = function (b64) {
				var str = atob(b64);
				var u8arr = new Uint8Array(str.length);
				for (var i = 0; i < str.length; i++)u8arr[i] = str.charCodeAt(i);
				return u8arr;
			};
			window.UrlB642Bytes = function (str) {
				str = str.replace(/_/g, "\/").replace(/-/g, "+");
				while (str.length % 4) str += "=";
				return Base642Bytes(str);
			};
			window.Bytes2UrlB64 = function (bytes) {//äºŒè¿›åˆ¶æ•°ç»„è½¬æˆurl base64
				return Bytes2Base64(bytes).replace(/\//g, "_").replace(/\+/g, "-").replace(/=/g, "");
			};
			window.Bytes2Base64 = function (bytes) {
				var str = "";
				if (typeof (bytes) == "string") {
					str = unescape(encodeURIComponent(bytes));
				} else {
					if (bytes instanceof ArrayBuffer) bytes = new Uint8Array(bytes);
					for (var i = 0; i < bytes.length; i++) str += String.fromCharCode(bytes[i]);
				}
				return btoa(str);
			};

		})();
	</script>


	<script>
		//===========================================
		//================= Launch ==================
		//===========================================
		//LICENSE: GPL-3.0, https://github.com/xiangyuecn/ACME-HTML-Web-Browser-Client
		(function () {
			"use strict";

			var msg = "";
			try {
				window.PageRawHTML = window.PageRawHTML || document.documentElement.outerHTML;
				if (window.top != window) {
					msg = Lang(
						'ä¸å…è®¸åœ¨IFrameå†…æ˜¾ç¤ºæœ¬é¡µé¢ï¼Œè¯·ç›´æ¥é€šè¿‡ç½‘å€è®¿é—®ï¼'
						, 'This page is not allowed to be displayed in IFrame, please visit it directly through the website!');
					throw new Error();
				}
				var SupportCrypto = false;
				eval('SupportCrypto=!!crypto.subtle.sign');
				eval('``;(async function(){class a{}})');
			} catch (e) {
				if (!msg && !SupportCrypto && window.isSecureContext === false) {
					msg = Lang('æµè§ˆå™¨ç¦æ­¢ä¸å®‰å…¨é¡µé¢è°ƒç”¨CryptoåŠŸèƒ½ï¼Œå¯å¼€å¯httpsè§£å†³ï¼Œæˆ–ä½¿ç”¨localhostã€file://è®¿é—®', 'The browser prohibits unsafe pages from calling Crypto function. You can enable https to solve the problem, or use localhost, file:// to access');
				}
				if (!msg) {
					msg = Lang('æµè§ˆå™¨ç‰ˆæœ¬å¤ªä½' + (SupportCrypto ? '' : 'ï¼ˆä¸æ”¯æŒCryptoï¼‰') + 'ï¼Œè¯·æ¢ä¸€ä¸ªæµè§ˆå™¨å†è¯•ï¼', 'The browser version is too low' + (SupportCrypto ? '' : ' (Crypto is not supported)') + '. Please change another browser and try again!');
				}
				document.body.innerHTML = '<div style="font-size:32px;color:red;font-weight:bold;text-align:center;padding-top:100px">' + msg + '</div>';
				return;
			}
			$(".main").html($(".main").html()); //å½»åº•å¹²æ‰è¾“å…¥æ¡†è‡ªåŠ¨å®Œæˆ
			$("input,textarea,select").attr("autocomplete", "off");

			$(".main-load").hide();
			$(".main").show();
			LangClick(LangCur);

			initMainUI();

			// è‡ªåŠ¨æ›´æ–°ç‰ˆæƒå¹´ä»½
			updateCopyrightYear();

		})();

		// è‡ªåŠ¨æ›´æ–°ç‰ˆæƒå¹´ä»½å‡½æ•°
		function updateCopyrightYear() {
			const currentYear = new Date().getFullYear();
			const yearElementCN = document.getElementById('currentYear');
			const yearElementEN = document.getElementById('currentYearEN');

			if (yearElementCN) {
				yearElementCN.textContent = currentYear;
			}
			if (yearElementEN) {
				yearElementEN.textContent = currentYear;
			}
		}
	</script>
	<!-- PageRawHTML: åé¢ä¸è®¸æ”¾å†…å®¹ -->

</body>

</html>